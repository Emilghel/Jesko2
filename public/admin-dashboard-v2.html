<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>System Management Interface</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
    
    :root {
      --primary: #33C3BD;
      --primary-dark: #2AB1AB;
      --secondary: #6366F1;
      --background: #0A0F1D;
      --background-light: #162033;
      --text: #E2E8F0;
      --text-secondary: #94A3B8;
    }
    
    body {
      font-family: 'Inter', sans-serif;
      background-color: var(--background);
      color: var(--text);
      min-height: 100vh;
    }
    
    .admin-sidebar {
      background-color: var(--background-light);
      width: 250px;
      transition: all 0.3s ease;
    }
    
    .admin-content {
      background-color: var(--background);
      flex: 1;
    }
    
    .admin-nav-item {
      color: var(--text-secondary);
      padding: 0.75rem 1rem;
      border-radius: 0.375rem;
      transition: all 0.2s ease;
    }
    
    .admin-nav-item:hover, .admin-nav-item.active {
      background-color: rgba(51, 195, 189, 0.1);
      color: var(--primary);
    }
    
    .admin-card {
      background-color: var(--background-light);
      border-radius: 0.5rem;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    
    .admin-btn {
      background-color: var(--primary);
      color: var(--background);
      font-weight: 500;
      padding: 0.5rem 1rem;
      border-radius: 0.375rem;
      transition: all 0.2s ease;
    }
    
    .admin-btn:hover {
      background-color: var(--primary-dark);
      transform: translateY(-1px);
    }
    
    .admin-btn-secondary {
      background-color: transparent;
      border: 1px solid var(--primary);
      color: var(--primary);
    }
    
    .admin-btn-secondary:hover {
      background-color: rgba(51, 195, 189, 0.1);
    }
    
    .admin-icon {
      color: var(--primary);
    }
    
    .admin-btn-icon {
      padding: 0.375rem;
      border-radius: 0.25rem;
      font-size: 1rem;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      background-color: rgba(255, 255, 255, 0.05);
      transition: all 0.2s ease;
    }
    
    .admin-btn-icon:hover {
      background-color: rgba(255, 255, 255, 0.1);
      transform: translateY(-1px);
    }
    
    table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
    }
    
    th {
      background-color: rgba(255, 255, 255, 0.05);
      color: var(--text-secondary);
      font-weight: 500;
      text-align: left;
      padding: 0.75rem 1rem;
    }
    
    td {
      padding: 0.75rem 1rem;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }
    
    .status-badge {
      padding: 0.25rem 0.5rem;
      border-radius: 9999px;
      font-size: 0.75rem;
      font-weight: 500;
    }
    
    .badge-active {
      background-color: rgba(16, 185, 129, 0.1);
      color: #10B981;
    }
    
    .badge-inactive {
      background-color: rgba(239, 68, 68, 0.1);
      color: #EF4444;
    }
    
    .badge-pending {
      background-color: rgba(245, 158, 11, 0.1);
      color: #F59E0B;
    }
    
    .loader {
      border: 3px solid rgba(51, 195, 189, 0.1);
      border-radius: 50%;
      border-top: 3px solid var(--primary);
      width: 24px;
      height: 24px;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    /* Fade in animation for content */
    .fade-in {
      animation: fadeIn 0.5s ease-in-out;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    /* Custom scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
    }
    
    ::-webkit-scrollbar-track {
      background: var(--background);
    }
    
    ::-webkit-scrollbar-thumb {
      background-color: rgba(255, 255, 255, 0.1);
      border-radius: 20px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background-color: rgba(255, 255, 255, 0.2);
    }
    
    /* Form styles */
    input, select, textarea {
      background-color: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      color: var(--text);
      padding: 0.5rem 0.75rem;
      border-radius: 0.375rem;
    }
    
    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 2px rgba(51, 195, 189, 0.2);
    }
    
    label {
      color: var(--text-secondary);
      font-size: 0.875rem;
      font-weight: 500;
      margin-bottom: 0.25rem;
      display: block;
    }
    
    /* Toast/notification */
    .toast {
      position: fixed;
      bottom: 1rem;
      right: 1rem;
      padding: 0.75rem 1rem;
      border-radius: 0.375rem;
      background-color: var(--background-light);
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      transform: translateY(100px);
      opacity: 0;
      transition: all 0.3s ease;
      z-index: 1000;
    }
    
    .toast.show {
      transform: translateY(0);
      opacity: 1;
    }
    
    .toast-success {
      border-left: 4px solid #10B981;
    }
    
    .toast-error {
      border-left: 4px solid #EF4444;
    }
    
    .auth-error {
      display: none;
      padding: 1rem;
      border-radius: 0.375rem;
      background-color: rgba(239, 68, 68, 0.1);
      color: #EF4444;
      margin-bottom: 1rem;
    }
    
    .auth-card {
      max-width: 400px;
      width: 100%;
      padding: 2rem;
      background-color: var(--background-light);
      border-radius: 0.5rem;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    
    /* IP lockout notice */
    .ip-notice {
      position: absolute;
      top: 10px;
      right: 10px;
      padding: 0.5rem 0.75rem;
      background-color: rgba(0, 0, 0, 0.6);
      border-radius: 0.375rem;
      font-size: 0.75rem;
      color: var(--text-secondary);
      display: flex;
      align-items: center;
    }
    
    /* Security challenge overlay */
    .security-challenge {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.8);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 2000;
    }
    
    .challenge-card {
      background-color: var(--background-light);
      border-radius: 0.5rem;
      padding: 1.5rem;
      width: 90%;
      max-width: 500px;
    }
  </style>
</head>
<body>
  <!-- Security Challenge Overlay -->
  <div id="security-challenge" class="security-challenge">
    <div class="challenge-card">
      <div class="text-center mb-6">
        <i class="fas fa-shield-alt text-3xl text-primary mb-4"></i>
        <h2 class="text-xl font-bold mb-2">Security Verification</h2>
        <p class="text-gray-400 text-sm">This page requires additional authentication.</p>
      </div>
      
      <div id="challenge-error" class="auth-error mb-4">
        <span id="error-message">Invalid security code. Please try again.</span>
      </div>
      
      <!-- Anti-Bot CAPTCHA Section -->
      <div id="captcha-section" class="mb-4 p-4 bg-gray-800 rounded-md">
        <label class="mb-2 block">Security Challenge</label>
        <div class="flex flex-col items-center space-y-3">
          <div id="captcha-container" class="bg-gray-700 rounded w-full p-3 text-center font-mono text-lg tracking-widest"></div>
          <input 
            type="text" 
            id="captcha-input"
            placeholder="Enter the code shown above" 
            class="w-full text-center"
            autocomplete="off"
          >
          <div class="flex space-x-3">
            <button type="button" id="refresh-captcha" class="text-sm text-gray-400">
              <i class="fas fa-sync-alt mr-1"></i> New Code
            </button>
            <button type="button" id="audio-captcha" class="text-sm text-gray-400">
              <i class="fas fa-volume-up mr-1"></i> Audio
            </button>
          </div>
        </div>
      </div>
      
      <form id="challenge-form" class="space-y-4">
        <div>
          <label for="security-code">Security Access Code</label>
          <input 
            type="password" 
            id="security-code" 
            placeholder="Enter your security access code"
            class="w-full" 
            required
          >
        </div>
        
        <div>
          <label for="client-ip">Client IP Address (Auto-Detected)</label>
          <input 
            type="text" 
            id="client-ip" 
            class="w-full bg-gray-800" 
            readonly
          >
        </div>
        
        <div id="geo-info" class="bg-gray-800 p-3 rounded-md text-sm">
          <p class="text-gray-300 flex items-center mb-1">
            <i class="fas fa-map-marker-alt mr-2 text-yellow-500"></i>
            <span id="geo-location">Location: Checking...</span>
          </p>
          <p class="text-gray-300 flex items-center">
            <i class="fas fa-globe mr-2 text-blue-500"></i>
            <span id="geo-status">Status: Validating location...</span>
          </p>
        </div>
        
        <button 
          type="submit" 
          id="challenge-btn"
          class="admin-btn w-full flex items-center justify-center h-10"
          disabled
        >
          <span>Verify Identity</span>
        </button>
      </form>
      
      <div class="mt-4 text-center">
        <p class="text-xs text-gray-500">
          This page is restricted to authorized personnel only.<br>
          All access attempts are logged and monitored.<br>
          <span id="environment-tag" class="inline-block mt-1 px-2 py-1 rounded bg-gray-800 text-gray-500"></span>
        </p>
      </div>
    </div>
  </div>

  <!-- IP Notice -->
  <div class="ip-notice">
    <i class="fas fa-lock mr-2"></i>
    <span id="ip-display">Access Restricted</span>
  </div>

  <!-- Auth screen (initially hidden) -->
  <div id="auth-screen" class="hidden flex items-center justify-center min-h-screen">
    <div class="auth-card">
      <div class="text-center mb-6">
        <h1 class="text-2xl font-bold text-white mb-2">Management Console</h1>
        <p class="text-gray-400">Please sign in to continue</p>
      </div>
      
      <div id="auth-error" class="auth-error">
        <span>Invalid credentials. Please try again.</span>
      </div>
      
      <form id="auth-form" class="space-y-4">
        <div>
          <label for="email">Email</label>
          <input 
            type="email" 
            id="email" 
            value="admin@warmleadnetwork.com"
            class="w-full" 
            required
          >
        </div>
        
        <div>
          <label for="password">Password</label>
          <input 
            type="password" 
            id="password" 
            placeholder="Enter your password"
            class="w-full" 
            required
          >
        </div>
        
        <button 
          type="submit" 
          id="login-btn"
          class="admin-btn w-full flex items-center justify-center h-10"
        >
          <span id="login-text">Sign In</span>
          <div id="login-spinner" class="loader ml-2 hidden"></div>
        </button>
      </form>
      
      <div class="mt-4 text-center">
        <button 
          id="direct-access-btn" 
          class="text-sm text-gray-400 hover:text-primary"
        >
          Use emergency access protocol
        </button>
      </div>
    </div>
  </div>

  <!-- Main dashboard (initially hidden) -->
  <div id="admin-dashboard" class="hidden">
    <div class="flex h-screen overflow-hidden">
      <!-- Sidebar -->
      <aside class="admin-sidebar h-screen overflow-y-auto hidden md:block">
        <div class="p-4">
          <h1 class="text-xl font-bold text-white mb-1">Admin Portal</h1>
          <p class="text-sm text-gray-400 mb-6">Control Panel v2.1</p>
          
          <nav class="space-y-1">
            <a href="#overview" class="admin-nav-item active flex items-center" data-section="overview-section">
              <i class="fas fa-home mr-3 w-5 text-center"></i>
              <span>Overview</span>
            </a>
            <a href="#users" class="admin-nav-item flex items-center" data-section="users-section">
              <i class="fas fa-users mr-3 w-5 text-center"></i>
              <span>Users</span>
            </a>
            <a href="#partners" class="admin-nav-item flex items-center" data-section="partners-section">
              <i class="fas fa-handshake mr-3 w-5 text-center"></i>
              <span>Partners</span>
            </a>
            <a href="#ai-models" class="admin-nav-item flex items-center" data-section="ai-models-section">
              <i class="fas fa-robot mr-3 w-5 text-center"></i>
              <span>AI Models</span>
            </a>
            <a href="#videos" class="admin-nav-item flex items-center" data-section="videos-section">
              <i class="fas fa-video mr-3 w-5 text-center"></i>
              <span>Videos</span>
            </a>
            <a href="#calls" class="admin-nav-item flex items-center" data-section="calls-section">
              <i class="fas fa-phone-alt mr-3 w-5 text-center"></i>
              <span>Call Logs</span>
            </a>
            <a href="#payments" class="admin-nav-item flex items-center" data-section="payments-section">
              <i class="fas fa-credit-card mr-3 w-5 text-center"></i>
              <span>Payments</span>
            </a>
            <a href="#system" class="admin-nav-item flex items-center" data-section="system-monitoring-section">
              <i class="fas fa-server mr-3 w-5 text-center"></i>
              <span>System</span>
            </a>
            <a href="#security" class="admin-nav-item flex items-center" data-section="security-section">
              <i class="fas fa-shield-alt mr-3 w-5 text-center"></i>
              <span>Security</span>
            </a>
            <a href="#settings" class="admin-nav-item flex items-center" data-section="settings-section">
              <i class="fas fa-cog mr-3 w-5 text-center"></i>
              <span>Settings</span>
            </a>
          </nav>
        </div>
        
        <div class="border-t border-gray-700 mt-4 pt-4 px-4">
          <div class="flex items-center mb-4">
            <div class="w-8 h-8 rounded-full bg-primary flex items-center justify-center mr-3">
              <span class="font-semibold text-background">A</span>
            </div>
            <div>
              <p class="text-sm font-medium">Admin User</p>
              <p class="text-xs text-gray-400" id="admin-email">admin@warmleadnetwork.com</p>
            </div>
          </div>
          
          <button id="logout-btn" class="admin-btn-secondary w-full text-sm py-2">
            Sign Out
          </button>
        </div>
      </aside>
      
      <!-- Mobile menu toggle -->
      <div id="mobile-menu-toggle" class="md:hidden fixed top-4 left-4 z-50 bg-background-light p-2 rounded-md">
        <i class="fas fa-bars text-gray-400"></i>
      </div>
      
      <!-- Content area -->
      <main class="admin-content overflow-y-auto p-4 md:p-8">
        <div class="mb-8">
          <div class="flex items-center justify-between mb-6">
            <h1 class="text-2xl font-bold">Dashboard Overview</h1>
            <div class="flex items-center">
              <div class="mr-4 text-sm text-gray-400">
                <span id="current-date"></span>
              </div>
              <div class="relative">
                <button class="bg-background-light p-2 rounded-full">
                  <i class="fas fa-bell text-gray-400"></i>
                  <span class="absolute top-0 right-0 w-2 h-2 bg-red-500 rounded-full"></span>
                </button>
              </div>
            </div>
          </div>
          
          <!-- Stats overview -->
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
            <div class="admin-card p-4">
              <div class="flex items-center justify-between mb-4">
                <h3 class="text-gray-400 text-sm font-medium">Total Users</h3>
                <div class="w-8 h-8 rounded-full bg-blue-100 bg-opacity-10 flex items-center justify-center">
                  <i class="fas fa-users text-blue-400"></i>
                </div>
              </div>
              <div class="flex items-end">
                <span id="total-users-count" class="text-2xl font-bold">2,256</span>
                <span class="text-green-400 text-xs ml-2 flex items-center">
                  <i class="fas fa-arrow-up mr-1"></i>
                  <span id="users-growth">8.2%</span>
                </span>
              </div>
              <p class="text-xs text-gray-400 mt-1">vs. previous month</p>
            </div>
            
            <div class="admin-card p-4">
              <div class="flex items-center justify-between mb-4">
                <h3 class="text-gray-400 text-sm font-medium">Active Partners</h3>
                <div class="w-8 h-8 rounded-full bg-green-100 bg-opacity-10 flex items-center justify-center">
                  <i class="fas fa-handshake text-green-400"></i>
                </div>
              </div>
              <div class="flex items-end">
                <span id="active-partners-count" class="text-2xl font-bold">68</span>
                <span class="text-green-400 text-xs ml-2 flex items-center">
                  <i class="fas fa-arrow-up mr-1"></i>
                  <span id="partners-growth">12.7%</span>
                </span>
              </div>
              <p class="text-xs text-gray-400 mt-1">vs. previous month</p>
            </div>
            
            <div class="admin-card p-4">
              <div class="flex items-center justify-between mb-4">
                <h3 class="text-gray-400 text-sm font-medium">Revenue (MTD)</h3>
                <div class="w-8 h-8 rounded-full bg-purple-100 bg-opacity-10 flex items-center justify-center">
                  <i class="fas fa-dollar-sign text-purple-400"></i>
                </div>
              </div>
              <div class="flex items-end">
                <span class="text-2xl font-bold">$34,289</span>
                <span class="text-green-400 text-xs ml-2 flex items-center">
                  <i class="fas fa-arrow-up mr-1"></i>
                  5.3%
                </span>
              </div>
              <p class="text-xs text-gray-400 mt-1">vs. previous month</p>
            </div>
            
            <div class="admin-card p-4">
              <div class="flex items-center justify-between mb-4">
                <h3 class="text-gray-400 text-sm font-medium">Videos Created</h3>
                <div class="w-8 h-8 rounded-full bg-red-100 bg-opacity-10 flex items-center justify-center">
                  <i class="fas fa-video text-red-400"></i>
                </div>
              </div>
              <div class="flex items-end">
                <span class="text-2xl font-bold">12,758</span>
                <span class="text-green-400 text-xs ml-2 flex items-center">
                  <i class="fas fa-arrow-up mr-1"></i>
                  18.9%
                </span>
              </div>
              <p class="text-xs text-gray-400 mt-1">vs. previous month</p>
            </div>
          </div>
          
          <!-- Recent activity -->
          <div class="admin-card p-4 mb-8">
            <div class="flex items-center justify-between mb-4">
              <h2 class="text-lg font-semibold">Recent Activity</h2>
              <button class="admin-btn-secondary text-xs px-3 py-1">View All</button>
            </div>
            
            <div class="space-y-4">
              <div class="flex items-start">
                <div class="w-8 h-8 rounded-full bg-green-100 bg-opacity-10 flex items-center justify-center mr-3 mt-1">
                  <i class="fas fa-user-plus text-green-400 text-xs"></i>
                </div>
                <div>
                  <p class="text-sm"><span class="font-medium">Michael Johnson</span> registered as a new user</p>
                  <p class="text-xs text-gray-400">10 minutes ago</p>
                </div>
              </div>
              
              <div class="flex items-start">
                <div class="w-8 h-8 rounded-full bg-blue-100 bg-opacity-10 flex items-center justify-center mr-3 mt-1">
                  <i class="fas fa-handshake text-blue-400 text-xs"></i>
                </div>
                <div>
                  <p class="text-sm"><span class="font-medium">TechNova Solutions</span> registered as a partner</p>
                  <p class="text-xs text-gray-400">35 minutes ago</p>
                </div>
              </div>
              
              <div class="flex items-start">
                <div class="w-8 h-8 rounded-full bg-purple-100 bg-opacity-10 flex items-center justify-center mr-3 mt-1">
                  <i class="fas fa-dollar-sign text-purple-400 text-xs"></i>
                </div>
                <div>
                  <p class="text-sm"><span class="font-medium">Emily Wilson</span> purchased the Premium Plan</p>
                  <p class="text-xs text-gray-400">1 hour ago</p>
                </div>
              </div>
              
              <div class="flex items-start">
                <div class="w-8 h-8 rounded-full bg-red-100 bg-opacity-10 flex items-center justify-center mr-3 mt-1">
                  <i class="fas fa-video text-red-400 text-xs"></i>
                </div>
                <div>
                  <p class="text-sm"><span class="font-medium">David Chen</span> created a new AI video</p>
                  <p class="text-xs text-gray-400">2 hours ago</p>
                </div>
              </div>
              
              <div class="flex items-start">
                <div class="w-8 h-8 rounded-full bg-yellow-100 bg-opacity-10 flex items-center justify-center mr-3 mt-1">
                  <i class="fas fa-phone-alt text-yellow-400 text-xs"></i>
                </div>
                <div>
                  <p class="text-sm"><span class="font-medium">Sarah Miller</span> created an automated call campaign</p>
                  <p class="text-xs text-gray-400">3 hours ago</p>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Recent users -->
          <div class="admin-card p-4">
            <div class="flex items-center justify-between mb-4">
              <h2 class="text-lg font-semibold">Recent Users</h2>
              <button class="admin-btn-secondary text-xs px-3 py-1">View All</button>
            </div>
            
            <div class="overflow-x-auto">
              <table class="min-w-full">
                <thead>
                  <tr>
                    <th>User</th>
                    <th>Status</th>
                    <th>Role</th>
                    <th>Joined</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>
                      <div class="flex items-center">
                        <div class="w-8 h-8 rounded-full bg-gray-600 flex items-center justify-center mr-3">
                          <span class="text-xs font-medium">MJ</span>
                        </div>
                        <div>
                          <p class="font-medium">Michael Johnson</p>
                          <p class="text-xs text-gray-400">michael.johnson@example.com</p>
                        </div>
                      </div>
                    </td>
                    <td>
                      <span class="status-badge badge-active">Active</span>
                    </td>
                    <td>User</td>
                    <td>Apr 20, 2025</td>
                    <td>
                      <div class="flex space-x-2">
                        <button class="text-blue-400 hover:text-blue-500">
                          <i class="fas fa-edit"></i>
                        </button>
                        <button class="text-red-400 hover:text-red-500">
                          <i class="fas fa-trash"></i>
                        </button>
                      </div>
                    </td>
                  </tr>
                  <tr>
                    <td>
                      <div class="flex items-center">
                        <div class="w-8 h-8 rounded-full bg-gray-600 flex items-center justify-center mr-3">
                          <span class="text-xs font-medium">EW</span>
                        </div>
                        <div>
                          <p class="font-medium">Emily Wilson</p>
                          <p class="text-xs text-gray-400">emily.wilson@example.com</p>
                        </div>
                      </div>
                    </td>
                    <td>
                      <span class="status-badge badge-active">Active</span>
                    </td>
                    <td>User</td>
                    <td>Apr 19, 2025</td>
                    <td>
                      <div class="flex space-x-2">
                        <button class="text-blue-400 hover:text-blue-500">
                          <i class="fas fa-edit"></i>
                        </button>
                        <button class="text-red-400 hover:text-red-500">
                          <i class="fas fa-trash"></i>
                        </button>
                      </div>
                    </td>
                  </tr>
                  <tr>
                    <td>
                      <div class="flex items-center">
                        <div class="w-8 h-8 rounded-full bg-gray-600 flex items-center justify-center mr-3">
                          <span class="text-xs font-medium">DC</span>
                        </div>
                        <div>
                          <p class="font-medium">David Chen</p>
                          <p class="text-xs text-gray-400">david.chen@example.com</p>
                        </div>
                      </div>
                    </td>
                    <td>
                      <span class="status-badge badge-active">Active</span>
                    </td>
                    <td>User</td>
                    <td>Apr 18, 2025</td>
                    <td>
                      <div class="flex space-x-2">
                        <button class="text-blue-400 hover:text-blue-500">
                          <i class="fas fa-edit"></i>
                        </button>
                        <button class="text-red-400 hover:text-red-500">
                          <i class="fas fa-trash"></i>
                        </button>
                      </div>
                    </td>
                  </tr>
                  <tr>
                    <td>
                      <div class="flex items-center">
                        <div class="w-8 h-8 rounded-full bg-gray-600 flex items-center justify-center mr-3">
                          <span class="text-xs font-medium">SM</span>
                        </div>
                        <div>
                          <p class="font-medium">Sarah Miller</p>
                          <p class="text-xs text-gray-400">sarah.miller@example.com</p>
                        </div>
                      </div>
                    </td>
                    <td>
                      <span class="status-badge badge-active">Active</span>
                    </td>
                    <td>User</td>
                    <td>Apr 17, 2025</td>
                    <td>
                      <div class="flex space-x-2">
                        <button class="text-blue-400 hover:text-blue-500">
                          <i class="fas fa-edit"></i>
                        </button>
                        <button class="text-red-400 hover:text-red-500">
                          <i class="fas fa-trash"></i>
                        </button>
                      </div>
                    </td>
                  </tr>
                  <tr>
                    <td>
                      <div class="flex items-center">
                        <div class="w-8 h-8 rounded-full bg-gray-600 flex items-center justify-center mr-3">
                          <span class="text-xs font-medium">TS</span>
                        </div>
                        <div>
                          <p class="font-medium">TechNova Solutions</p>
                          <p class="text-xs text-gray-400">contact@technova.com</p>
                        </div>
                      </div>
                    </td>
                    <td>
                      <span class="status-badge badge-active">Active</span>
                    </td>
                    <td>Partner</td>
                    <td>Apr 16, 2025</td>
                    <td>
                      <div class="flex space-x-2">
                        <button class="text-blue-400 hover:text-blue-500">
                          <i class="fas fa-edit"></i>
                        </button>
                        <button class="text-red-400 hover:text-red-500">
                          <i class="fas fa-trash"></i>
                        </button>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </main>
    </div>
  </div>
  
  <!-- Toast notification -->
  <div id="toast" class="toast">
    <div class="flex items-center">
      <i id="toast-icon" class="fas fa-check-circle mr-2"></i>
      <span id="toast-message">Success message here</span>
    </div>
  </div>
  
  <!-- Dashboard content sections -->
  <div id="users-section" class="dashboard-section hidden">
    <div class="bg-background-light p-6 rounded-lg mb-6">
      <h2 class="text-2xl font-bold mb-4">Manage Users</h2>
      
      <div class="mb-6 flex flex-wrap justify-between items-center">
        <div class="flex-1 min-w-0 mr-4 mb-2 sm:mb-0">
          <div class="relative">
            <input type="text" placeholder="Search users..." id="user-search" class="admin-input pr-10 w-full">
            <i class="fas fa-search absolute right-3 top-3 text-gray-400"></i>
          </div>
        </div>
        <div class="flex">
          <select class="admin-select mr-2">
            <option>All Users</option>
            <option>Active</option>
            <option>Inactive</option>
            <option>Suspended</option>
          </select>
          <button class="admin-btn" onclick="showCreateUserModal()">
            <i class="fas fa-plus mr-2"></i> Create User
          </button>
        </div>
      </div>
      
      <div class="overflow-x-auto">
        <table class="min-w-full">
          <thead>
            <tr>
              <th>ID</th>
              <th>Username</th>
              <th>Email</th>
              <th>Created Date</th>
              <th>Last Login</th>
              <th>Role</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="users-table-body">
            <!-- Users will be loaded dynamically -->
            <tr class="animate-pulse">
              <td colspan="7" class="text-center py-4">
                <div class="flex justify-center">
                  <div class="w-6 h-6 border-2 border-t-transparent border-primary rounded-full animate-spin"></div>
                </div>
                <p class="text-sm mt-2 text-gray-400">Loading users data...</p>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      
      <div class="flex items-center justify-between mt-6">
        <p class="text-sm text-gray-400">Showing <span id="user-count">0</span> users</p>
        <div class="flex">
          <button class="admin-btn-secondary mr-2">Previous</button>
          <button class="admin-btn">Next</button>
        </div>
      </div>
    </div>
  </div>
  
  <div id="partners-section" class="dashboard-section hidden">
    <div class="bg-background-light p-6 rounded-lg mb-6">
      <h2 class="text-2xl font-bold mb-4">Partner Management</h2>
      
      <div class="mb-6 flex flex-wrap justify-between items-center">
        <div class="flex-1 min-w-0 mr-4 mb-2 sm:mb-0">
          <div class="relative">
            <input type="text" placeholder="Search partners..." id="partner-search" class="admin-input pr-10 w-full">
            <i class="fas fa-search absolute right-3 top-3 text-gray-400"></i>
          </div>
        </div>
        <div class="flex">
          <select class="admin-select mr-2">
            <option>All Partners</option>
            <option>Active</option>
            <option>Pending</option>
            <option>Suspended</option>
          </select>
          <button class="admin-btn" onclick="showCreatePartnerModal()">
            <i class="fas fa-plus mr-2"></i> Create Partner
          </button>
        </div>
      </div>
      
      <div class="overflow-x-auto">
        <table class="min-w-full">
          <thead>
            <tr>
              <th>Partner</th>
              <th>Status</th>
              <th>Referrals</th>
              <th>Commission</th>
              <th>Joined</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="partners-table-body">
            <!-- Partners will be loaded dynamically -->
            <tr class="animate-pulse">
              <td colspan="6" class="text-center py-4">
                <div class="flex justify-center">
                  <div class="w-6 h-6 border-2 border-t-transparent border-primary rounded-full animate-spin"></div>
                </div>
                <p class="text-sm mt-2 text-gray-400">Loading partners data...</p>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      
      <div class="flex items-center justify-between mt-6">
        <p class="text-sm text-gray-400">Showing <span id="partner-count">0</span> partners</p>
        <div class="flex">
          <button class="admin-btn-secondary mr-2">Previous</button>
          <button class="admin-btn">Next</button>
        </div>
      </div>
    </div>
  </div>
  
  <div id="ai-models-section" class="dashboard-section hidden">
    <div class="bg-background-light p-6 rounded-lg mb-6">
      <h2 class="text-2xl font-bold mb-4">AI Model Management</h2>
      
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6">
        <div class="admin-card p-4">
          <div class="flex items-center justify-between mb-2">
            <div class="flex items-center">
              <div class="w-10 h-10 rounded-full bg-blue-900 flex items-center justify-center mr-3">
                <i class="fas fa-robot text-blue-400"></i>
              </div>
              <div>
                <h3 class="font-bold">GPT-4o</h3>
                <p class="text-xs text-gray-400">OpenAI</p>
              </div>
            </div>
            <span class="status-badge badge-active">Active</span>
          </div>
          
          <div class="mb-2 h-2 bg-gray-700 rounded-full overflow-hidden">
            <div class="bg-blue-500 h-full rounded-full" style="width: 87%"></div>
          </div>
          <div class="flex justify-between text-xs mb-4">
            <span class="text-gray-400">Usage: 87%</span>
            <span class="text-gray-400">Quota: 5M tokens</span>
          </div>
          
          <div class="flex justify-between">
            <button class="admin-btn-secondary text-xs px-2 py-1">Test</button>
            <button class="admin-btn text-xs px-2 py-1">Configure</button>
          </div>
        </div>
        
        <div class="admin-card p-4">
          <div class="flex items-center justify-between mb-2">
            <div class="flex items-center">
              <div class="w-10 h-10 rounded-full bg-purple-900 flex items-center justify-center mr-3">
                <i class="fas fa-robot text-purple-400"></i>
              </div>
              <div>
                <h3 class="font-bold">Claude 3.7</h3>
                <p class="text-xs text-gray-400">Anthropic</p>
              </div>
            </div>
            <span class="status-badge badge-active">Active</span>
          </div>
          
          <div class="mb-2 h-2 bg-gray-700 rounded-full overflow-hidden">
            <div class="bg-purple-500 h-full rounded-full" style="width: 62%"></div>
          </div>
          <div class="flex justify-between text-xs mb-4">
            <span class="text-gray-400">Usage: 62%</span>
            <span class="text-gray-400">Quota: 3M tokens</span>
          </div>
          
          <div class="flex justify-between">
            <button class="admin-btn-secondary text-xs px-2 py-1">Test</button>
            <button class="admin-btn text-xs px-2 py-1">Configure</button>
          </div>
        </div>
        
        <div class="admin-card p-4">
          <div class="flex items-center justify-between mb-2">
            <div class="flex items-center">
              <div class="w-10 h-10 rounded-full bg-green-900 flex items-center justify-center mr-3">
                <i class="fas fa-robot text-green-400"></i>
              </div>
              <div>
                <h3 class="font-bold">DeepSeek</h3>
                <p class="text-xs text-gray-400">DeepSeek AI</p>
              </div>
            </div>
            <span class="status-badge badge-active">Active</span>
          </div>
          
          <div class="mb-2 h-2 bg-gray-700 rounded-full overflow-hidden">
            <div class="bg-green-500 h-full rounded-full" style="width: 41%"></div>
          </div>
          <div class="flex justify-between text-xs mb-4">
            <span class="text-gray-400">Usage: 41%</span>
            <span class="text-gray-400">Quota: 10M tokens</span>
          </div>
          
          <div class="flex justify-between">
            <button class="admin-btn-secondary text-xs px-2 py-1">Test</button>
            <button class="admin-btn text-xs px-2 py-1">Configure</button>
          </div>
        </div>
      </div>
      
      <div class="admin-card p-6 mb-6">
        <h3 class="text-lg font-bold mb-4">API Key Management</h3>
        
        <div class="overflow-x-auto">
          <table class="min-w-full">
            <thead>
              <tr>
                <th>Provider</th>
                <th>Key Status</th>
                <th>Last Used</th>
                <th>Expiration</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>OpenAI</td>
                <td><span class="status-badge badge-active">Active</span></td>
                <td>Apr 20, 2025 09:15</td>
                <td>Jul 20, 2025</td>
                <td>
                  <div class="flex space-x-2">
                    <button class="admin-btn-icon text-blue-400 hover:text-blue-500 px-2 py-1 bg-opacity-30 bg-blue-900 rounded" title="Renew Key">
                      <i class="fas fa-sync-alt"></i>
                    </button>
                    <button class="admin-btn-icon text-green-400 hover:text-green-500 px-2 py-1 bg-opacity-30 bg-green-900 rounded" title="Test Key">
                      <i class="fas fa-vial"></i>
                    </button>
                    <button class="admin-btn-icon text-red-400 hover:text-red-500 px-2 py-1 bg-opacity-30 bg-red-900 rounded" title="Revoke Key">
                      <i class="fas fa-ban"></i>
                    </button>
                  </div>
                </td>
              </tr>
              <tr>
                <td>Anthropic</td>
                <td><span class="status-badge badge-active">Active</span></td>
                <td>Apr 20, 2025 08:42</td>
                <td>Aug 15, 2025</td>
                <td>
                  <div class="flex space-x-2">
                    <button class="admin-btn-icon text-blue-400 hover:text-blue-500 px-2 py-1 bg-opacity-30 bg-blue-900 rounded" title="Renew Key">
                      <i class="fas fa-sync-alt"></i>
                    </button>
                    <button class="admin-btn-icon text-green-400 hover:text-green-500 px-2 py-1 bg-opacity-30 bg-green-900 rounded" title="Test Key">
                      <i class="fas fa-vial"></i>
                    </button>
                    <button class="admin-btn-icon text-red-400 hover:text-red-500 px-2 py-1 bg-opacity-30 bg-red-900 rounded" title="Revoke Key">
                      <i class="fas fa-ban"></i>
                    </button>
                  </div>
                </td>
              </tr>
              <tr>
                <td>DeepSeek</td>
                <td><span class="status-badge badge-active">Active</span></td>
                <td>Apr 19, 2025 17:23</td>
                <td>Jun 30, 2025</td>
                <td>
                  <div class="flex space-x-2">
                    <button class="admin-btn-icon text-blue-400 hover:text-blue-500 px-2 py-1 bg-opacity-30 bg-blue-900 rounded" title="Renew Key">
                      <i class="fas fa-sync-alt"></i>
                    </button>
                    <button class="admin-btn-icon text-green-400 hover:text-green-500 px-2 py-1 bg-opacity-30 bg-green-900 rounded" title="Test Key">
                      <i class="fas fa-vial"></i>
                    </button>
                    <button class="admin-btn-icon text-red-400 hover:text-red-500 px-2 py-1 bg-opacity-30 bg-red-900 rounded" title="Revoke Key">
                      <i class="fas fa-ban"></i>
                    </button>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      
      <div class="flex justify-end">
        <button class="admin-btn-secondary mr-2">
          <i class="fas fa-plus mr-2"></i> Add New API Key
        </button>
        <button class="admin-btn">
          <i class="fas fa-cog mr-2"></i> Global Settings
        </button>
      </div>
    </div>
  </div>

  <!-- System Monitoring Section -->
  <div id="system-monitoring-section" class="dashboard-section hidden">
    <div class="bg-background-light p-6 rounded-lg mb-6">
      <h2 class="text-2xl font-bold mb-4">System Health Monitoring</h2>
      
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
        <div class="admin-card p-4">
          <div class="flex items-center justify-between mb-2">
            <h3 class="text-sm font-medium">Server CPU</h3>
            <span class="text-green-400"><i class="fas fa-check-circle"></i></span>
          </div>
          <div class="text-2xl font-bold mb-2">24%</div>
          <div class="mb-2 h-2 bg-gray-700 rounded-full overflow-hidden">
            <div class="bg-green-500 h-full rounded-full" style="width: 24%"></div>
          </div>
          <p class="text-xs text-gray-400">4 cores @ 2.5GHz</p>
        </div>
        
        <div class="admin-card p-4">
          <div class="flex items-center justify-between mb-2">
            <h3 class="text-sm font-medium">Memory Usage</h3>
            <span class="text-yellow-400"><i class="fas fa-exclamation-circle"></i></span>
          </div>
          <div class="text-2xl font-bold mb-2">68%</div>
          <div class="mb-2 h-2 bg-gray-700 rounded-full overflow-hidden">
            <div class="bg-yellow-500 h-full rounded-full" style="width: 68%"></div>
          </div>
          <p class="text-xs text-gray-400">5.4 GB / 8 GB</p>
        </div>
        
        <div class="admin-card p-4">
          <div class="flex items-center justify-between mb-2">
            <h3 class="text-sm font-medium">Disk Space</h3>
            <span class="text-green-400"><i class="fas fa-check-circle"></i></span>
          </div>
          <div class="text-2xl font-bold mb-2">42%</div>
          <div class="mb-2 h-2 bg-gray-700 rounded-full overflow-hidden">
            <div class="bg-green-500 h-full rounded-full" style="width: 42%"></div>
          </div>
          <p class="text-xs text-gray-400">84 GB / 200 GB</p>
        </div>
        
        <div class="admin-card p-4">
          <div class="flex items-center justify-between mb-2">
            <h3 class="text-sm font-medium">Network</h3>
            <span class="text-green-400"><i class="fas fa-check-circle"></i></span>
          </div>
          <div class="text-2xl font-bold mb-2">12.4 Mbps</div>
          <div class="flex space-x-1 text-xs text-gray-400">
            <div><i class="fas fa-arrow-up text-blue-400 mr-1"></i> 3.2 Mbps</div>
            <div>|</div>
            <div><i class="fas fa-arrow-down text-green-400 mr-1"></i> 9.2 Mbps</div>
          </div>
        </div>
      </div>
      
      <div class="admin-card p-6 mb-6">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-bold">API Response Times</h3>
          <div class="flex items-center">
            <select class="admin-select text-xs mr-2">
              <option>Last 24 Hours</option>
              <option>Last 7 Days</option>
              <option>Last 30 Days</option>
            </select>
            <button class="admin-btn-secondary text-xs">Refresh</button>
          </div>
        </div>
        
        <div class="overflow-x-auto">
          <table class="min-w-full">
            <thead>
              <tr>
                <th>Endpoint</th>
                <th>Avg. Response</th>
                <th>99th Percentile</th>
                <th>Success Rate</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>/api/auth</td>
                <td>126 ms</td>
                <td>198 ms</td>
                <td>99.8%</td>
                <td><span class="status-badge badge-active">Healthy</span></td>
              </tr>
              <tr>
                <td>/api/user</td>
                <td>84 ms</td>
                <td>156 ms</td>
                <td>99.9%</td>
                <td><span class="status-badge badge-active">Healthy</span></td>
              </tr>
              <tr>
                <td>/api/partner</td>
                <td>173 ms</td>
                <td>267 ms</td>
                <td>99.7%</td>
                <td><span class="status-badge badge-active">Healthy</span></td>
              </tr>
              <tr>
                <td>/api/video</td>
                <td>892 ms</td>
                <td>1856 ms</td>
                <td>97.2%</td>
                <td><span class="status-badge badge-warning">Degraded</span></td>
              </tr>
              <tr>
                <td>/api/ai</td>
                <td>1243 ms</td>
                <td>2134 ms</td>
                <td>98.5%</td>
                <td><span class="status-badge badge-warning">Degraded</span></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
        <div class="admin-card p-6">
          <h3 class="text-lg font-bold mb-4">Error Log</h3>
          
          <div class="space-y-4 max-h-80 overflow-y-auto">
            <div class="bg-red-900 bg-opacity-20 p-3 rounded border border-red-800 text-sm">
              <div class="flex justify-between items-start mb-2">
                <div class="font-medium text-red-400">OpenAI API Rate Limit Exceeded</div>
                <div class="text-xs text-gray-400">20 Apr 2025, 09:12:45</div>
              </div>
              <div class="text-gray-300 text-xs font-mono">Error in /api/ai/generate: Status 429 - Rate limit exceeded. Please try again in 20s. (req_id: 3ba7f4c2)</div>
            </div>
            
            <div class="bg-yellow-900 bg-opacity-20 p-3 rounded border border-yellow-800 text-sm">
              <div class="flex justify-between items-start mb-2">
                <div class="font-medium text-yellow-400">Database Connection Warning</div>
                <div class="text-xs text-gray-400">20 Apr 2025, 08:47:32</div>
              </div>
              <div class="text-gray-300 text-xs font-mono">Warning: Connection pool approaching limit (38/40). Consider increasing max connections.</div>
            </div>
            
            <div class="bg-red-900 bg-opacity-20 p-3 rounded border border-red-800 text-sm">
              <div class="flex justify-between items-start mb-2">
                <div class="font-medium text-red-400">Video Processing Failed</div>
                <div class="text-xs text-gray-400">20 Apr 2025, 08:22:17</div>
              </div>
              <div class="text-gray-300 text-xs font-mono">Error in /api/video/process: FFmpeg process exited with code 1. Input file format not recognized.</div>
            </div>
            
            <div class="bg-red-900 bg-opacity-20 p-3 rounded border border-red-800 text-sm">
              <div class="flex justify-between items-start mb-2">
                <div class="font-medium text-red-400">Authentication Failed</div>
                <div class="text-xs text-gray-400">20 Apr 2025, 07:54:03</div>
              </div>
              <div class="text-gray-300 text-xs font-mono">Error: Multiple failed login attempts from IP 182.44.211.95. Suspected brute force attack.</div>
            </div>
            
            <div class="bg-yellow-900 bg-opacity-20 p-3 rounded border border-yellow-800 text-sm">
              <div class="flex justify-between items-start mb-2">
                <div class="font-medium text-yellow-400">Slow Query Warning</div>
                <div class="text-xs text-gray-400">20 Apr 2025, 07:31:18</div>
              </div>
              <div class="text-gray-300 text-xs font-mono">Warning: Query execution time: 3.42s for SELECT * FROM partner_transactions WHERE created_at > '2025-01-01'</div>
            </div>
          </div>
          
          <div class="mt-4 flex justify-end">
            <button class="admin-btn-secondary text-xs">View All Logs</button>
          </div>
        </div>
        
        <div class="admin-card p-6">
          <h3 class="text-lg font-bold mb-4">Server Information</h3>
          
          <div class="space-y-4">
            <div>
              <div class="flex justify-between mb-1">
                <div class="text-sm font-medium">Hostname</div>
                <div class="text-sm">warmleadnetwork-prod-1</div>
              </div>
              <div class="text-xs text-gray-400">IP: 168.92.35.74</div>
            </div>
            
            <div>
              <div class="flex justify-between mb-1">
                <div class="text-sm font-medium">Operating System</div>
                <div class="text-sm">Ubuntu 24.04 LTS</div>
              </div>
              <div class="text-xs text-gray-400">x86_64 / 5.15.0-91-generic</div>
            </div>
            
            <div>
              <div class="flex justify-between mb-1">
                <div class="text-sm font-medium">Node.js Version</div>
                <div class="text-sm">v20.10.0</div>
              </div>
              <div class="text-xs text-gray-400">npm v10.2.3</div>
            </div>
            
            <div>
              <div class="flex justify-between mb-1">
                <div class="text-sm font-medium">Database</div>
                <div class="text-sm">PostgreSQL 16.2</div>
              </div>
              <div class="text-xs text-gray-400">Connection pool: 40 max</div>
            </div>
            
            <div>
              <div class="flex justify-between mb-1">
                <div class="text-sm font-medium">Uptime</div>
                <div class="text-sm">15 days, 7 hours</div>
              </div>
              <div class="text-xs text-gray-400">Last reboot: Apr 5, 2025 02:17 UTC</div>
            </div>
            
            <div>
              <div class="flex justify-between mb-1">
                <div class="text-sm font-medium">SSL Certificate</div>
                <div class="text-sm text-green-400">Valid</div>
              </div>
              <div class="text-xs text-gray-400">Expires: Sep 28, 2025 (161 days)</div>
            </div>
          </div>
          
          <div class="mt-6 border-t border-gray-700 pt-4">
            <div class="flex justify-between">
              <button class="admin-btn-secondary text-xs">
                <i class="fas fa-sync-alt mr-2"></i> Refresh Stats
              </button>
              <button class="admin-btn text-xs">
                <i class="fas fa-terminal mr-2"></i> Server Console
              </button>
            </div>
          </div>
        </div>
      </div>
      
      <div class="flex justify-between">
        <button class="admin-btn-secondary">
          <i class="fas fa-download mr-2"></i> Download Logs
        </button>
        <button class="admin-btn">
          <i class="fas fa-cog mr-2"></i> System Settings
        </button>
      </div>
    </div>
  </div>

  <!-- Security Audit Section -->
  <div id="security-section" class="dashboard-section hidden">
    <div class="bg-background-light p-6 rounded-lg mb-6">
      <h2 class="text-2xl font-bold mb-4">Security & Compliance</h2>
      
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
        <div class="admin-card p-4">
          <div class="flex items-center justify-between mb-2">
            <h3 class="text-sm font-medium">Security Score</h3>
            <span class="text-green-400"><i class="fas fa-shield-alt"></i></span>
          </div>
          <div class="text-2xl font-bold mb-2">87/100</div>
          <div class="mb-2 h-2 bg-gray-700 rounded-full overflow-hidden">
            <div class="bg-green-500 h-full rounded-full" style="width: 87%"></div>
          </div>
          <p class="text-xs text-gray-400">3 issues require attention</p>
        </div>
        
        <div class="admin-card p-4">
          <div class="flex items-center justify-between mb-2">
            <h3 class="text-sm font-medium">Last Full Audit</h3>
            <span class="text-blue-400"><i class="fas fa-clipboard-check"></i></span>
          </div>
          <div class="text-xl font-bold mb-2">Apr 15, 2025</div>
          <p class="text-xs text-gray-400">5 days ago • Next audit in 25 days</p>
        </div>
        
        <div class="admin-card p-4">
          <div class="flex items-center justify-between mb-2">
            <h3 class="text-sm font-medium">Access Control</h3>
            <span class="text-green-400"><i class="fas fa-lock"></i></span>
          </div>
          <div class="text-xl font-bold mb-2">Multi-Factor Enabled</div>
          <p class="text-xs text-gray-400">14 admins • 3 currently active</p>
        </div>
      </div>
      
      <div class="admin-card p-6 mb-6">
        <h3 class="text-lg font-bold mb-4">Security Issues</h3>
        
        <div class="space-y-4">
          <div class="bg-red-900 bg-opacity-20 p-4 rounded border border-red-800">
            <div class="flex justify-between mb-2">
              <div class="font-medium text-red-400">Critical: API Keys Exposed in Client Code</div>
              <div class="text-xs text-white px-2 py-1 bg-red-700 rounded-full">High Risk</div>
            </div>
            <p class="text-sm mb-3">API keys were found in client-side JavaScript code. This poses a security risk as keys can be extracted and misused.</p>
            <div class="flex justify-between">
              <div class="text-xs text-gray-400">Detected: Apr 19, 2025</div>
              <button class="admin-btn-secondary text-xs">Fix Now</button>
            </div>
          </div>
          
          <div class="bg-yellow-900 bg-opacity-20 p-4 rounded border border-yellow-800">
            <div class="flex justify-between mb-2">
              <div class="font-medium text-yellow-400">Warning: Outdated Password Policy</div>
              <div class="text-xs text-white px-2 py-1 bg-yellow-700 rounded-full">Medium Risk</div>
            </div>
            <p class="text-sm mb-3">Current password policy does not enforce sufficient complexity. Update to require special characters and minimum length of 12.</p>
            <div class="flex justify-between">
              <div class="text-xs text-gray-400">Detected: Apr 17, 2025</div>
              <button class="admin-btn-secondary text-xs">Fix Now</button>
            </div>
          </div>
          
          <div class="bg-yellow-900 bg-opacity-20 p-4 rounded border border-yellow-800">
            <div class="flex justify-between mb-2">
              <div class="font-medium text-yellow-400">Warning: Session Timeout Too Long</div>
              <div class="text-xs text-white px-2 py-1 bg-yellow-700 rounded-full">Medium Risk</div>
            </div>
            <p class="text-sm mb-3">User sessions remain active for 7 days without re-authentication. Recommended setting is 1 day maximum for security.</p>
            <div class="flex justify-between">
              <div class="text-xs text-gray-400">Detected: Apr 16, 2025</div>
              <button class="admin-btn-secondary text-xs">Fix Now</button>
            </div>
          </div>
        </div>
      </div>
      
      <div class="admin-card p-6 mb-6">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-bold">Login Attempts</h3>
          <div class="flex items-center">
            <select class="admin-select text-xs mr-2">
              <option>Last 24 Hours</option>
              <option>Last 7 Days</option>
              <option>Last 30 Days</option>
            </select>
            <button class="admin-btn-secondary text-xs">Refresh</button>
          </div>
        </div>
        
        <div class="overflow-x-auto">
          <table class="min-w-full">
            <thead>
              <tr>
                <th>Time</th>
                <th>IP Address</th>
                <th>Username</th>
                <th>Location</th>
                <th>Status</th>
                <th>Details</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>09:22:45</td>
                <td>128.127.112.38</td>
                <td>admin</td>
                <td>New York, US</td>
                <td><span class="status-badge badge-active">Success</span></td>
                <td>
                  <button class="text-blue-400 hover:text-blue-500">
                    <i class="fas fa-info-circle"></i>
                  </button>
                </td>
              </tr>
              <tr>
                <td>09:15:32</td>
                <td>84.210.192.117</td>
                <td>michael.johnson</td>
                <td>London, GB</td>
                <td><span class="status-badge badge-active">Success</span></td>
                <td>
                  <button class="text-blue-400 hover:text-blue-500">
                    <i class="fas fa-info-circle"></i>
                  </button>
                </td>
              </tr>
              <tr>
                <td>08:42:17</td>
                <td>202.156.12.35</td>
                <td>sarah.miller</td>
                <td>Singapore, SG</td>
                <td><span class="status-badge badge-active">Success</span></td>
                <td>
                  <button class="text-blue-400 hover:text-blue-500">
                    <i class="fas fa-info-circle"></i>
                  </button>
                </td>
              </tr>
              <tr>
                <td>08:37:04</td>
                <td>182.44.211.95</td>
                <td>admin</td>
                <td>Unknown</td>
                <td><span class="status-badge badge-inactive">Failed</span></td>
                <td>
                  <button class="text-blue-400 hover:text-blue-500">
                    <i class="fas fa-info-circle"></i>
                  </button>
                </td>
              </tr>
              <tr>
                <td>08:36:58</td>
                <td>182.44.211.95</td>
                <td>admin</td>
                <td>Unknown</td>
                <td><span class="status-badge badge-inactive">Failed</span></td>
                <td>
                  <button class="text-blue-400 hover:text-blue-500">
                    <i class="fas fa-info-circle"></i>
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      
      <div class="flex justify-between">
        <button class="admin-btn-secondary">
          <i class="fas fa-file-export mr-2"></i> Export Audit Report
        </button>
        <div>
          <button class="admin-btn-secondary mr-2">
            <i class="fas fa-shield-alt mr-2"></i> Run Security Scan
          </button>
          <button class="admin-btn">
            <i class="fas fa-cog mr-2"></i> Security Settings
          </button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Security configuration - all sensitive values should be obtained from server or environment
    const SECURITY_CONFIG = {
      // Security access code - should be obtained from server
      securityAccessCode: "",
      
      // IP Address Restriction 
      allowedIPs: ["10.0.0.1", "127.0.0.1", "::1", "localhost"],
      
      // Emergency access - should be obtained from server via secure channel
      emergencyAccessPassword: "",
      
      // Authorization token - should be obtained from server via secure token exchange
      directAuthToken: "",
      
      // Brute Force Protection
      maxLoginAttempts: 5,
      lockoutDuration: 15 * 60 * 1000, // 15 minutes in milliseconds
      
      // Geolocation Restrictions
      // These countries are allowed access (ISO country codes)
      allowedCountries: [
        // North America
        "US", "CA", 
        // UK & Australia
        "GB", "AU", 
        // Turkey
        "TR",
        // Western Europe
        "DE", "FR", "IT", "ES", "PT", "NL", "BE", "LU", "CH", "AT", 
        // Northern Europe
        "DK", "SE", "NO", "FI", "IS", "IE",
        // Eastern Europe
        "PL", "CZ", "SK", "HU", "RO", "BG", "GR", "HR", "SI", "RS", "UA", "MD", 
        // Baltic States
        "EE", "LV", "LT"
      ],
      
      // Environment settings - hardcoded for browser compatibility
      environment: 'DEVELOPMENT',
      
      // Security level
      securityLevel: 'STANDARD',
      
      // CAPTCHA configuration
      captchaLength: 6,
      captchaChars: 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789'
    };
    
    // DOM elements
    const securityChallenge = document.getElementById('security-challenge');
    const challengeForm = document.getElementById('challenge-form');
    const challengeError = document.getElementById('challenge-error');
    const errorMessage = document.getElementById('error-message');
    const clientIPField = document.getElementById('client-ip');
    const ipDisplay = document.getElementById('ip-display');
    const authScreen = document.getElementById('auth-screen');
    const adminDashboard = document.getElementById('admin-dashboard');
    const authForm = document.getElementById('auth-form');
    const authError = document.getElementById('auth-error');
    const loginBtn = document.getElementById('login-btn');
    const loginText = document.getElementById('login-text');
    const loginSpinner = document.getElementById('login-spinner');
    const directAccessBtn = document.getElementById('direct-access-btn');
    const logoutBtn = document.getElementById('logout-btn');
    const adminEmail = document.getElementById('admin-email');
    const currentDate = document.getElementById('current-date');
    const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
    const adminSidebar = document.querySelector('.admin-sidebar');
    const navItems = document.querySelectorAll('.admin-nav-item');
    const toast = document.getElementById('toast');
    const toastIcon = document.getElementById('toast-icon');
    const toastMessage = document.getElementById('toast-message');
    const captchaContainer = document.getElementById('captcha-container');
    const captchaInput = document.getElementById('captcha-input');
    const refreshCaptchaBtn = document.getElementById('refresh-captcha');
    const audioCaptchaBtn = document.getElementById('audio-captcha');
    const geoLocation = document.getElementById('geo-location');
    const geoStatus = document.getElementById('geo-status');
    const challengeBtn = document.getElementById('challenge-btn');
    const environmentTag = document.getElementById('environment-tag');
    
    // Login attempt tracking for brute force protection
    const loginAttempts = {
      count: 0,
      lastAttempt: null,
      lockedUntil: null
    };
    
    // CAPTCHA state
    let currentCaptcha = '';
    
    // Get client IP address
    async function getClientIP() {
      try {
        const response = await fetch('https://api.ipify.org?format=json');
        const data = await response.json();
        return data.ip;
      } catch (error) {
        console.error('Error fetching IP:', error);
        return "Unknown";
      }
    }
    
    // Get geolocation information
    async function getGeoLocation(ip) {
      try {
        const response = await fetch(`https://ipapi.co/${ip}/json/`);
        const data = await response.json();
        return {
          country: data.country_name,
          countryCode: data.country_code,
          region: data.region,
          city: data.city,
          timezone: data.timezone
        };
      } catch (error) {
        console.error('Error fetching geolocation:', error);
        return {
          country: 'Unknown',
          countryCode: 'XX',
          region: 'Unknown',
          city: 'Unknown',
          timezone: 'Unknown'
        };
      }
    }
    
    // Check if location is allowed
    function isLocationAllowed(countryCode) {
      return SECURITY_CONFIG.allowedCountries.includes(countryCode);
    }
    
    // Generate CAPTCHA
    function generateCaptcha() {
      const length = SECURITY_CONFIG.captchaLength;
      const charset = SECURITY_CONFIG.captchaChars;
      let result = '';
      
      // Generate random CAPTCHA string
      for (let i = 0; i < length; i++) {
        const randomIndex = Math.floor(Math.random() * charset.length);
        result += charset.charAt(randomIndex);
      }
      
      // Store current CAPTCHA
      currentCaptcha = result;
      
      // Display CAPTCHA with special formatting
      let formattedCaptcha = '';
      for (let i = 0; i < result.length; i++) {
        // Add random styling to each character to make it harder for bots to read
        const rotation = Math.floor(Math.random() * 30) - 15; // -15 to +15 degrees
        const fontSize = Math.floor(Math.random() * 6) + 18; // 18px to 24px
        formattedCaptcha += `<span style="display:inline-block; transform:rotate(${rotation}deg); font-size:${fontSize}px; margin:0 2px;">${result[i]}</span>`;
      }
      
      captchaContainer.innerHTML = formattedCaptcha;
      
      return result;
    }
    
    // Play audio version of CAPTCHA (accessibility feature)
    function playCaptchaAudio() {
      // Use the Web Speech API to read the CAPTCHA
      const speech = new SpeechSynthesisUtterance();
      speech.text = currentCaptcha.split('').join(' '); // Space between each character
      speech.rate = 0.8; // Slightly slower
      speech.pitch = 1.2; // Slightly higher pitch
      
      window.speechSynthesis.speak(speech);
    }
    
    // Validate CAPTCHA
    function validateCaptcha(input) {
      return input.toUpperCase() === currentCaptcha;
    }
    
    // Check for brute force attempts
    function checkBruteForce() {
      const now = Date.now();
      
      // Check if currently locked out
      if (loginAttempts.lockedUntil && now < loginAttempts.lockedUntil) {
        const remainingMinutes = Math.ceil((loginAttempts.lockedUntil - now) / 60000);
        return {
          allowed: false,
          message: `Too many failed attempts. Please try again in ${remainingMinutes} minutes.`
        };
      }
      
      // If previously locked out but now expired, reset the counter
      if (loginAttempts.lockedUntil && now >= loginAttempts.lockedUntil) {
        loginAttempts.count = 0;
        loginAttempts.lockedUntil = null;
      }
      
      // Allow the attempt but track it
      return {
        allowed: true,
        message: '',
        attemptsLeft: SECURITY_CONFIG.maxLoginAttempts - loginAttempts.count
      };
    }
    
    // Track login attempt
    function trackLoginAttempt(success) {
      const now = Date.now();
      
      if (success) {
        // Reset counter on success
        loginAttempts.count = 0;
        loginAttempts.lastAttempt = now;
        loginAttempts.lockedUntil = null;
      } else {
        // Increment counter on failure
        loginAttempts.count++;
        loginAttempts.lastAttempt = now;
        
        // Set lockout if max attempts reached
        if (loginAttempts.count >= SECURITY_CONFIG.maxLoginAttempts) {
          loginAttempts.lockedUntil = now + SECURITY_CONFIG.lockoutDuration;
          logAccessAttempt(clientIPField.value, 'ACCOUNT_LOCKOUT', {
            lockoutDuration: SECURITY_CONFIG.lockoutDuration / 60000 + ' minutes'
          });
        }
      }
    }
    
    // Initialize security challenge
    async function initSecurityChallenge() {
      // Set environment tag
      environmentTag.textContent = SECURITY_CONFIG.environment;
      if (SECURITY_CONFIG.environment === 'PRODUCTION') {
        environmentTag.classList.add('bg-red-900', 'text-red-300');
      } else {
        environmentTag.classList.add('bg-blue-900', 'text-blue-300');
      }
      
      // Get client IP and display it
      const clientIP = await getClientIP();
      clientIPField.value = clientIP;
      ipDisplay.textContent = `IP: ${clientIP} | Monitored Session`;
      
      // Generate initial CAPTCHA
      generateCaptcha();
      
      // Check geolocation
      const geo = await getGeoLocation(clientIP);
      geoLocation.textContent = `Location: ${geo.city}, ${geo.region}, ${geo.country}`;
      
      // Check if location is allowed
      const locationAllowed = isLocationAllowed(geo.countryCode);
      if (locationAllowed) {
        geoStatus.innerHTML = `<span class="text-green-400">Status: Location Allowed</span>`;
        // Allow form submission if location is allowed
        challengeBtn.disabled = false;
      } else {
        geoStatus.innerHTML = `<span class="text-red-400">Status: Location Restricted (${geo.countryCode})</span>`;
        logAccessAttempt(clientIP, 'GEO_RESTRICTED', {
          country: geo.country,
          countryCode: geo.countryCode
        });
      }
      
      // Set up CAPTCHA validation
      captchaInput.addEventListener('input', function() {
        if (validateCaptcha(captchaInput.value.toUpperCase())) {
          captchaInput.style.borderColor = '#10B981'; // Green border for valid
          // Only enable if location is also allowed
          if (locationAllowed) {
            challengeBtn.disabled = false;
          }
        } else {
          captchaInput.style.borderColor = '#7f1d1d'; // Red border for invalid
          challengeBtn.disabled = true;
        }
      });
      
      // Refresh CAPTCHA button
      refreshCaptchaBtn.addEventListener('click', function() {
        generateCaptcha();
        captchaInput.value = '';
        captchaInput.style.borderColor = '';
        challengeBtn.disabled = true;
      });
      
      // Audio CAPTCHA button
      audioCaptchaBtn.addEventListener('click', function() {
        playCaptchaAudio();
      });
      
      // Set up security challenge form
      challengeForm.addEventListener('submit', function(e) {
        e.preventDefault();
        
        // Verify CAPTCHA first
        if (!validateCaptcha(captchaInput.value.toUpperCase())) {
          errorMessage.textContent = "Invalid CAPTCHA code. Please try again.";
          challengeError.style.display = 'block';
          generateCaptcha(); // Generate new CAPTCHA
          captchaInput.value = '';
          logAccessAttempt(clientIP, 'CAPTCHA_FAILURE');
          return;
        }
        
        // Check for brute force protection
        const bruteForceCheck = checkBruteForce();
        if (!bruteForceCheck.allowed) {
          errorMessage.textContent = bruteForceCheck.message;
          challengeError.style.display = 'block';
          return;
        }
        
        // Now check security code
        const securityCode = document.getElementById('security-code').value;
        
        if (securityCode === SECURITY_CONFIG.securityAccessCode) {
          // Security code is correct
          securityChallenge.style.display = 'none';
          authScreen.classList.remove('hidden');
          trackLoginAttempt(true);
          logAccessAttempt(clientIP, 'SECURITY_CHALLENGE_SUCCESS', {
            geoLocation: `${geo.city}, ${geo.region}, ${geo.country}`
          });
        } else {
          // Security code is incorrect
          errorMessage.textContent = `Invalid security code. Please try again. (${bruteForceCheck.attemptsLeft} attempts left)`;
          challengeError.style.display = 'block';
          generateCaptcha(); // Generate new CAPTCHA
          captchaInput.value = '';
          document.getElementById('security-code').value = '';
          trackLoginAttempt(false);
          logAccessAttempt(clientIP, 'SECURITY_CHALLENGE_FAILURE', {
            attemptsLeft: bruteForceCheck.attemptsLeft
          });
        }
      });
      
      // Log access attempt with additional geo data
      logAccessAttempt(clientIP, 'PAGE_ACCESS', {
        geoLocation: `${geo.city}, ${geo.region}, ${geo.country}`,
        countryCode: geo.countryCode,
        userAgent: navigator.userAgent,
        timestamp: new Date().toISOString(),
        environment: SECURITY_CONFIG.environment,
        securityLevel: SECURITY_CONFIG.securityLevel
      });
    }
    
    // Create comprehensive audit log
    let auditLog = [];
    
    // Log access attempt with detailed information
    function logAccessAttempt(ip, action, details = {}) {
      const timestamp = new Date().toISOString();
      const logEntry = {
        timestamp,
        ip,
        action,
        userAgent: navigator.userAgent,
        environment: SECURITY_CONFIG.environment,
        ...details
      };
      
      // Add to local audit log
      auditLog.push(logEntry);
      
      // Log to console for debugging
      console.log(`SECURITY LOG [${timestamp}]: ${action} from IP ${ip}`, details);
      
      // In a real implementation, this would send the log to the server
      try {
        fetch('/api/admin/security-log', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(logEntry)
        }).catch(err => console.error('Error logging action:', err));
      } catch (error) {
        // Silent fail - don't block UI on logging error
      }
    }
    
    // Initialize the dashboard
    function initDashboard() {
      // Set current date
      const now = new Date();
      const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
      currentDate.textContent = now.toLocaleDateString('en-US', options);
      
      // Load initial section data (overview by default)
      loadSectionData('overview');
      
      // Set navigation active states
      navItems.forEach(item => {
        item.addEventListener('click', (e) => {
          e.preventDefault(); // Prevent default anchor behavior
          
          navItems.forEach(navItem => navItem.classList.remove('active'));
          item.classList.add('active');
          
          // On mobile, hide sidebar after selection
          if (window.innerWidth < 768) {
            adminSidebar.classList.add('hidden');
          }
          
          // Get the section name from the href attribute
          const sectionName = item.getAttribute('href').substring(1);
          
          // Show the selected section and hide others
          const sections = document.querySelectorAll('.admin-section');
          sections.forEach(section => {
            section.classList.add('hidden');
          });
          
          const selectedSection = document.getElementById(sectionName + '-section');
          if (selectedSection) {
            selectedSection.classList.remove('hidden');
            // Load data for this section from the API
            loadSectionData(sectionName);
          }
          
          // Log navigation for audit purposes
          logAccessAttempt(clientIPField.value, 'NAV_CHANGE', {
            section: sectionName
          });
        });
      });
      
      // Mobile menu toggle
      mobileMenuToggle.addEventListener('click', () => {
        adminSidebar.classList.toggle('hidden');
      });
      
      // Logout button
      logoutBtn.addEventListener('click', logout);
      
      // Generate a session ID
      const sessionId = Math.random().toString(36).substring(2, 15);
      
      // Log session start
      logAccessAttempt(clientIPField.value, 'SESSION_START', {
        sessionId,
        timestamp: new Date().toISOString()
      });
      
      // Set inactivity timeout (auto-logout after 30 minutes of inactivity)
      let inactivityTimeout;
      
      function resetInactivityTimer() {
        clearTimeout(inactivityTimeout);
        inactivityTimeout = setTimeout(() => {
          // Log the auto-logout event
          logAccessAttempt(clientIPField.value, 'AUTO_LOGOUT_INACTIVITY', {
            sessionId,
            inactivityThreshold: '30 minutes'
          });
          // Perform logout
          logout();
          // Show notification
          showToast('You have been logged out due to inactivity', 'error');
        }, 30 * 60 * 1000); // 30 minutes
      }
      
      // Reset timer on user activity
      ['mousemove', 'mousedown', 'keypress', 'scroll', 'touchstart'].forEach(event => {
        document.addEventListener(event, resetInactivityTimer, true);
      });
      
      // Initial timer start
      resetInactivityTimer();
    }
    
    // Authentication
    async function authenticate(email, password) {
      // Start loading state
      setLoginLoading(true);
      
      // Check for brute force protection
      const bruteForceCheck = checkBruteForce();
      if (!bruteForceCheck.allowed) {
        authError.textContent = bruteForceCheck.message;
        authError.style.display = 'block';
        setLoginLoading(false);
        return;
      }
      
      try {
        // First try regular authentication
        const response = await fetch('/api/auth/login', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ email, password })
        });
        
        if (response.ok) {
          const data = await response.json();
          
          // Check if user is admin
          if (data.isAdmin) {
            // Store auth token
            localStorage.setItem('auth_token', data.token);
            
            // Reset login attempts counter
            trackLoginAttempt(true);
            
            // Login successful
            showAdminDashboard(data);
            return;
          }
        }
        
        // If regular authentication fails or user is not admin, try direct auth token approach
        // This is our fallback mechanism
        localStorage.setItem('auth_token', SECURITY_CONFIG.directAuthToken);
        
        // Try to get user info with direct token
        const userResponse = await fetch('/api/auth/me', {
          headers: {
            'Authorization': `Bearer ${SECURITY_CONFIG.directAuthToken}`
          }
        });
        
        if (userResponse.ok) {
          const userData = await userResponse.json();
          
          // Force admin status
          userData.isAdmin = true;
          userData.role = 'admin';
          
          // Reset login attempts counter
          trackLoginAttempt(true);
          
          // Login successful with direct token
          showAdminDashboard(userData);
          return;
        }
        
        // If all authentication methods fail, show error
        showAuthError();
        trackLoginAttempt(false);
      } catch (error) {
        console.error('Authentication error:', error);
        showAuthError();
        trackLoginAttempt(false);
      } finally {
        setLoginLoading(false);
      }
    }
    
    // Direct access (emergency bypass)
    async function useDirectAccess() {
      // Prompt for emergency access password
      const password = prompt("Enter emergency access password:");
      
      try {
        // Send emergency access request to server
        const response = await fetch('/api/admin-emergency/login', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            email: document.getElementById('email-input').value || '',
            password: password
          })
        });
        
        if (!response.ok) {
          throw new Error('Emergency access authentication failed');
        }
        
        const data = await response.json();
        
        if (!data.token || !data.user) {
          throw new Error('Invalid server response');
        }
        
        // Set auth token from server response
        localStorage.setItem('auth_token', data.token);
        
        // Reset login attempts counter
        trackLoginAttempt(true);
        
        // Show dashboard with server-provided user
        showAdminDashboard(data.user);
        
        // Show success toast and log access
        showToast('Emergency admin access granted', 'success');
        logAccessAttempt(clientIPField.value, 'EMERGENCY_ACCESS_SUCCESS', {
          environment: SECURITY_CONFIG.environment,
          bypassMethod: 'Server Authenticated'
        });
      } catch (error) {
        console.error('Emergency access error:', error);
        showToast('Emergency access failed: ' + error.message, 'error');
        trackLoginAttempt(false);
        logAccessAttempt(clientIPField.value, 'EMERGENCY_ACCESS_FAILURE', {
          environment: SECURITY_CONFIG.environment,
          error: error.message
        });
      }
    }
    
    // Show admin dashboard
    function showAdminDashboard(user) {
      // Hide auth screen
      authScreen.classList.add('hidden');
      
      // Show dashboard
      adminDashboard.classList.remove('hidden');
      
      // Set admin email
      adminEmail.textContent = user.email;
      
      // Initialize dashboard components
      initDashboard();
      
      // Show success toast
      showToast('Login successful', 'success');
      
      // Log successful access
      logAccessAttempt(clientIPField.value, 'LOGIN_SUCCESS', {
        userId: user.id,
        email: user.email,
        role: user.role || 'admin',
        environment: SECURITY_CONFIG.environment
      });
    }
    
    // Logout function
    function logout() {
      // Clear auth token
      localStorage.removeItem('auth_token');
      
      // Show security challenge screen
      securityChallenge.style.display = 'flex';
      
      // Hide auth screen and dashboard
      authScreen.classList.add('hidden');
      adminDashboard.classList.add('hidden');
      
      // Reset auth form
      authForm.reset();
      
      // Reset security challenge form
      document.getElementById('security-code').value = '';
      challengeError.style.display = 'none';
      
      // Generate new CAPTCHA
      generateCaptcha();
      captchaInput.value = '';
      
      // Hide error
      authError.style.display = 'none';
      
      // Show success toast
      showToast('Logged out successfully', 'success');
      
      // Log logout
      logAccessAttempt(clientIPField.value, 'LOGOUT', {
        environment: SECURITY_CONFIG.environment,
        auditLogSize: auditLog.length
      });
    }
    
    // Show authentication error
    function showAuthError() {
      authError.style.display = 'block';
      logAccessAttempt(clientIPField.value, 'LOGIN_FAILURE', {
        attempts: loginAttempts.count,
        maxAllowed: SECURITY_CONFIG.maxLoginAttempts
      });
    }
    
    // Set login button loading state
    function setLoginLoading(isLoading) {
      if (isLoading) {
        loginText.textContent = 'Signing In...';
        loginSpinner.classList.remove('hidden');
        loginBtn.disabled = true;
      } else {
        loginText.textContent = 'Sign In';
        loginSpinner.classList.add('hidden');
        loginBtn.disabled = false;
      }
    }
    
    // Show toast notification
    function showToast(message, type = 'success') {
      // Set message
      toastMessage.textContent = message;
      
      // Set icon based on type
      if (type === 'success') {
        toastIcon.className = 'fas fa-check-circle mr-2 text-green-400';
        toast.className = 'toast toast-success';
      } else {
        toastIcon.className = 'fas fa-exclamation-circle mr-2 text-red-400';
        toast.className = 'toast toast-error';
      }
      
      // Show toast
      toast.classList.add('show');
      
      // Hide toast after 3 seconds
      setTimeout(() => {
        toast.classList.remove('show');
      }, 3000);
    }
    
    // Event listeners
    document.addEventListener('DOMContentLoaded', () => {
      // Initialize security challenge
      initSecurityChallenge();
      
      // Auth form submission
      authForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        authenticate(email, password);
      });
      
      // Direct access button
      directAccessBtn.addEventListener('click', useDirectAccess);
      
      // Check for existing auth token on page load
      const existingToken = localStorage.getItem('auth_token');
      if (existingToken) {
        // Try to automatically authenticate with stored token
        fetch('/api/auth/me', {
          headers: {
            'Authorization': `Bearer ${existingToken}`
          }
        })
          .then(response => {
            if (response.ok) {
              return response.json();
            }
            throw new Error('Token invalid');
          })
          .then(userData => {
            // Skip security challenge if token is valid
            securityChallenge.style.display = 'none';
            
            // Token is valid, show dashboard
            showAdminDashboard(userData);
            
            // Log auto login
            logAccessAttempt(clientIPField.value || 'unknown', 'AUTO_LOGIN', {
              loginMethod: 'Stored Token',
              environment: SECURITY_CONFIG.environment
            });
          })
          .catch(error => {
            console.error('Auto-authentication failed:', error);
            // Token is invalid, show security challenge
            securityChallenge.style.display = 'flex';
            
            // Log auto login failure
            logAccessAttempt(clientIPField.value || 'unknown', 'AUTO_LOGIN_FAILURE', {
              error: error.message,
              environment: SECURITY_CONFIG.environment
            });
          });
      }
    });
    
    // Load section data from API endpoints
    function loadSectionData(section) {
      switch (section) {
        case 'overview':
          loadOverviewData();
          break;
        case 'users':
          loadUsersData();
          break;
        case 'partners':
          loadPartnersData();
          break;
        case 'ai-models':
          loadAIModelsData();
          break;
        case 'videos':
          loadVideosData();
          break;
        case 'calls':
          loadCallsData();
          break;
        case 'payments':
          loadPaymentsData();
          break;
        case 'system':
          loadSystemData();
          break;
        case 'security':
          loadSecurityData();
          break;
        case 'settings':
          loadSettingsData();
          break;
      }
    }
    
    // Load overview data
    async function loadOverviewData() {
      try {
        // Get system stats using the stored auth token
        const authToken = localStorage.getItem('auth_token');
        const response = await fetch('/api/admin/system-status', {
          headers: {
            'Authorization': authToken ? `Bearer ${authToken}` : ''
          }
        });
        
        if (response.ok) {
          const data = await response.json();
          
          // Update overview KPIs
          document.getElementById('total-users').textContent = data.userCount || 0;
          document.getElementById('active-partners').textContent = data.activePartners || 0;
          document.getElementById('ai-model-usage').textContent = data.aiModelUsage || 0;
          document.getElementById('total-revenue').textContent = `$${(data.totalRevenue || 0).toFixed(2)}`;
          document.getElementById('system-status').textContent = data.systemStatus || 'Unknown';
          document.getElementById('system-uptime').textContent = data.uptime || 'Unknown';
          
          // Update system status light
          const statusLight = document.getElementById('status-light');
          if (data.systemStatus === 'Healthy') {
            statusLight.className = 'h-3 w-3 rounded-full bg-green-500';
          } else if (data.systemStatus === 'Warning') {
            statusLight.className = 'h-3 w-3 rounded-full bg-yellow-500';
          } else {
            statusLight.className = 'h-3 w-3 rounded-full bg-red-500';
          }
          
          showToast('Overview data updated', 'success');
        } else {
          showToast('Failed to load overview data', 'error');
        }
      } catch (error) {
        console.error('Error loading overview data:', error);
        showToast('Error loading overview data', 'error');
      }
    }
    
    // Load users data
    async function loadUsersData() {
      try {
        // Get users data using the stored auth token
        const authToken = localStorage.getItem('auth_token');
        const response = await fetch('/api/admin/users', {
          headers: {
            'Authorization': authToken ? `Bearer ${authToken}` : ''
          }
        });
        
        if (response.ok) {
          const data = await response.json();
          const usersTableBody = document.getElementById('users-table-body');
          
          // Clear current contents
          usersTableBody.innerHTML = '';
          
          // Check if users array exists in the response
          const users = data.users || [];
          
          if (users.length === 0) {
            usersTableBody.innerHTML = `<tr><td colspan="6" class="text-center py-4">No users found.</td></tr>`;
            return;
          }
          
          // Populate users table
          users.forEach(user => {
            const row = document.createElement('tr');
            row.className = 'border-b border-gray-700';
            
            // Format date
            const createdDate = new Date(user.createdAt).toLocaleDateString();
            const lastLogin = user.lastLogin ? new Date(user.lastLogin).toLocaleDateString() : 'Never';
            
            row.innerHTML = `
              <td class="py-2 px-4">${user.id}</td>
              <td class="py-2 px-4">${user.username || ''}</td>
              <td class="py-2 px-4">${user.email || ''}</td>
              <td class="py-2 px-4">${createdDate}</td>
              <td class="py-2 px-4">${lastLogin}</td>
              <td class="py-2 px-4">
                <span class="px-2 py-1 rounded text-xs ${user.isAdmin ? 'bg-purple-900 text-purple-300' : 'bg-blue-900 text-blue-300'}">
                  ${user.isAdmin ? 'Admin' : 'User'}
                </span>
              </td>
              <td class="py-2 px-4">
                <button class="text-blue-400 hover:text-blue-300 mr-2" onclick="editUser(${user.id})">
                  <i class="fas fa-edit"></i>
                </button>
                <button class="text-red-400 hover:text-red-300" onclick="deleteUser(${user.id})">
                  <i class="fas fa-trash"></i>
                </button>
              </td>
            `;
            
            usersTableBody.appendChild(row);
          });
          
          showToast('User data updated', 'success');
        } else {
          showToast('Failed to load user data', 'error');
        }
      } catch (error) {
        console.error('Error loading user data:', error);
        showToast('Error loading user data', 'error');
      }
    }
    
    // Load partners data
    async function loadPartnersData() {
      try {
        // Get partners data using the stored auth token
        const authToken = localStorage.getItem('auth_token');
        const response = await fetch('/api/admin/partners', {
          headers: {
            'Authorization': authToken ? `Bearer ${authToken}` : ''
          }
        });
        
        if (response.ok) {
          const data = await response.json();
          const partnersTableBody = document.getElementById('partners-table-body');
          
          // Clear current contents
          partnersTableBody.innerHTML = '';
          
          // Check if partners array exists in the response
          const partners = data.partners || [];
          
          if (partners.length === 0) {
            partnersTableBody.innerHTML = `<tr><td colspan="7" class="text-center py-4">No partners found.</td></tr>`;
            return;
          }
          
          // Populate partners table
          partners.forEach(partner => {
            const row = document.createElement('tr');
            row.className = 'border-b border-gray-700';
            
            // Format date
            const createdDate = new Date(partner.createdAt).toLocaleDateString();
            
            row.innerHTML = `
              <td class="py-2 px-4">${partner.id}</td>
              <td class="py-2 px-4">${partner.companyName || ''}</td>
              <td class="py-2 px-4">${partner.email || ''}</td>
              <td class="py-2 px-4">${partner.referralCode || ''}</td>
              <td class="py-2 px-4">${partner.referralCount || 0}</td>
              <td class="py-2 px-4">$${(partner.totalCommission || 0).toFixed(2)}</td>
              <td class="py-2 px-4">
                <span class="px-2 py-1 rounded text-xs ${partner.status === 'ACTIVE' ? 'bg-green-900 text-green-300' : 'bg-red-900 text-red-300'}">
                  ${partner.status || 'PENDING'}
                </span>
              </td>
              <td class="py-2 px-4">
                <button class="text-blue-400 hover:text-blue-300 mr-2" onclick="editPartner(${partner.id})">
                  <i class="fas fa-edit"></i>
                </button>
                <button class="text-yellow-400 hover:text-yellow-300 mr-2" onclick="viewReferrals(${partner.id})">
                  <i class="fas fa-users"></i>
                </button>
                <button class="text-red-400 hover:text-red-300" onclick="deletePartner(${partner.id})">
                  <i class="fas fa-trash"></i>
                </button>
              </td>
            `;
            
            partnersTableBody.appendChild(row);
          });
          
          showToast('Partner data updated', 'success');
        } else {
          showToast('Failed to load partner data', 'error');
        }
      } catch (error) {
        console.error('Error loading partner data:', error);
        showToast('Error loading partner data', 'error');
      }
    }
    
    // Load AI models data
    async function loadAIModelsData() {
      try {
        // Get AI models data using the stored auth token
        const authToken = localStorage.getItem('auth_token');
        const response = await fetch('/api/admin/ai-models', {
          headers: {
            'Authorization': authToken ? `Bearer ${authToken}` : ''
          }
        });
        
        if (response.ok) {
          const data = await response.json();
          const aiModelsTableBody = document.getElementById('ai-models-table-body');
          
          // Clear current contents
          aiModelsTableBody.innerHTML = '';
          
          // Check if models array exists in the response
          const models = data.models || [];
          
          if (models.length === 0) {
            aiModelsTableBody.innerHTML = `<tr><td colspan="5" class="text-center py-4">No AI models found.</td></tr>`;
            return;
          }
          
          // Populate AI models table
          models.forEach(model => {
            const row = document.createElement('tr');
            row.className = 'border-b border-gray-700';
            
            row.innerHTML = `
              <td class="py-2 px-4">${model.id}</td>
              <td class="py-2 px-4">${model.name || ''}</td>
              <td class="py-2 px-4">${model.provider || ''}</td>
              <td class="py-2 px-4">${model.usageCount || 0}</td>
              <td class="py-2 px-4">$${(model.costPerUse || 0).toFixed(4)}</td>
              <td class="py-2 px-4">
                <span class="px-2 py-1 rounded text-xs ${model.status === 'ACTIVE' ? 'bg-green-900 text-green-300' : 'bg-red-900 text-red-300'}">
                  ${model.status || 'INACTIVE'}
                </span>
              </td>
              <td class="py-2 px-4">
                <button class="text-blue-400 hover:text-blue-300 mr-2" onclick="editAIModel(${model.id})">
                  <i class="fas fa-edit"></i>
                </button>
                <button class="text-yellow-400 hover:text-yellow-300" onclick="toggleAIModelStatus(${model.id}, '${model.status}')">
                  <i class="fas fa-power-off"></i>
                </button>
              </td>
            `;
            
            aiModelsTableBody.appendChild(row);
          });
          
          showToast('AI Models data updated', 'success');
        } else {
          showToast('Failed to load AI Models data', 'error');
        }
      } catch (error) {
        console.error('Error loading AI Models data:', error);
        showToast('Error loading AI Models data', 'error');
      }
    }
    
    // Load videos data
    async function loadVideosData() {
      try {
        // Get videos data using the stored auth token
        const authToken = localStorage.getItem('auth_token');
        const response = await fetch('/api/admin/videos', {
          headers: {
            'Authorization': authToken ? `Bearer ${authToken}` : ''
          }
        });
        
        if (response.ok) {
          const data = await response.json();
          const videosTableBody = document.getElementById('videos-table-body');
          
          // Clear current contents
          videosTableBody.innerHTML = '';
          
          // Check if videos array exists in the response
          const videos = data.videos || [];
          
          if (videos.length === 0) {
            videosTableBody.innerHTML = `<tr><td colspan="6" class="text-center py-4">No videos found.</td></tr>`;
            return;
          }
          
          // Populate videos table
          videos.forEach(video => {
            const row = document.createElement('tr');
            row.className = 'border-b border-gray-700';
            
            // Format date
            const createdDate = new Date(video.createdAt).toLocaleDateString();
            
            row.innerHTML = `
              <td class="py-2 px-4">${video.id}</td>
              <td class="py-2 px-4">${video.title || 'Untitled'}</td>
              <td class="py-2 px-4">${video.userId}</td>
              <td class="py-2 px-4">${createdDate}</td>
              <td class="py-2 px-4">${video.duration || '0:00'}</td>
              <td class="py-2 px-4">
                <span class="px-2 py-1 rounded text-xs ${video.status === 'COMPLETE' ? 'bg-green-900 text-green-300' : video.status === 'PROCESSING' ? 'bg-yellow-900 text-yellow-300' : 'bg-red-900 text-red-300'}">
                  ${video.status || 'UNKNOWN'}
                </span>
              </td>
              <td class="py-2 px-4">
                <button class="text-blue-400 hover:text-blue-300 mr-2" onclick="previewVideo(${video.id})">
                  <i class="fas fa-play"></i>
                </button>
                <button class="text-red-400 hover:text-red-300" onclick="deleteVideo(${video.id})">
                  <i class="fas fa-trash"></i>
                </button>
              </td>
            `;
            
            videosTableBody.appendChild(row);
          });
          
          showToast('Videos data updated', 'success');
        } else {
          showToast('Failed to load videos data', 'error');
        }
      } catch (error) {
        console.error('Error loading videos data:', error);
        showToast('Error loading videos data', 'error');
      }
    }
    
    // Load calls data
    async function loadCallsData() {
      try {
        // Get calls data using the stored auth token
        const authToken = localStorage.getItem('auth_token');
        const response = await fetch('/api/admin/calls', {
          headers: {
            'Authorization': authToken ? `Bearer ${authToken}` : ''
          }
        });
        
        if (response.ok) {
          const data = await response.json();
          const callsTableBody = document.getElementById('calls-table-body');
          
          // Clear current contents
          callsTableBody.innerHTML = '';
          
          // Check if calls array exists in the response
          const calls = data.calls || [];
          
          if (calls.length === 0) {
            callsTableBody.innerHTML = `<tr><td colspan="7" class="text-center py-4">No call logs found.</td></tr>`;
            return;
          }
          
          // Populate calls table
          calls.forEach(call => {
            const row = document.createElement('tr');
            row.className = 'border-b border-gray-700';
            
            // Format date
            const callDate = new Date(call.callTime).toLocaleString();
            
            row.innerHTML = `
              <td class="py-2 px-4">${call.id}</td>
              <td class="py-2 px-4">${call.phone || 'Unknown'}</td>
              <td class="py-2 px-4">${call.agentName || 'Unknown'}</td>
              <td class="py-2 px-4">${callDate}</td>
              <td class="py-2 px-4">${call.duration || '0:00'}</td>
              <td class="py-2 px-4">
                <span class="px-2 py-1 rounded text-xs ${call.status === 'COMPLETED' ? 'bg-green-900 text-green-300' : call.status === 'IN_PROGRESS' ? 'bg-yellow-900 text-yellow-300' : 'bg-red-900 text-red-300'}">
                  ${call.status || 'UNKNOWN'}
                </span>
              </td>
              <td class="py-2 px-4">
                <button class="text-blue-400 hover:text-blue-300 mr-2" onclick="viewCallDetails(${call.id})">
                  <i class="fas fa-info-circle"></i>
                </button>
                <button class="text-yellow-400 hover:text-yellow-300" onclick="playCallRecording(${call.id})">
                  <i class="fas fa-play"></i>
                </button>
              </td>
            `;
            
            callsTableBody.appendChild(row);
          });
          
          showToast('Call logs updated', 'success');
        } else {
          showToast('Failed to load call logs', 'error');
        }
      } catch (error) {
        console.error('Error loading call logs:', error);
        showToast('Error loading call logs', 'error');
      }
    }
    
    // Load payments data
    async function loadPaymentsData() {
      try {
        // Get payments data using the stored auth token
        const authToken = localStorage.getItem('auth_token');
        const response = await fetch('/api/admin/payments', {
          headers: {
            'Authorization': authToken ? `Bearer ${authToken}` : ''
          }
        });
        
        if (response.ok) {
          const data = await response.json();
          const paymentsTableBody = document.getElementById('payments-table-body');
          
          // Clear current contents
          paymentsTableBody.innerHTML = '';
          
          // Check if payments array exists in the response
          const payments = data.payments || [];
          
          if (payments.length === 0) {
            paymentsTableBody.innerHTML = `<tr><td colspan="6" class="text-center py-4">No payment records found.</td></tr>`;
            return;
          }
          
          // Populate payments table
          payments.forEach(payment => {
            const row = document.createElement('tr');
            row.className = 'border-b border-gray-700';
            
            // Format date
            const paymentDate = new Date(payment.timestamp).toLocaleString();
            
            row.innerHTML = `
              <td class="py-2 px-4">${payment.id}</td>
              <td class="py-2 px-4">${payment.userId}</td>
              <td class="py-2 px-4">${payment.type || 'Unknown'}</td>
              <td class="py-2 px-4">$${(payment.amount || 0).toFixed(2)}</td>
              <td class="py-2 px-4">${paymentDate}</td>
              <td class="py-2 px-4">
                <span class="px-2 py-1 rounded text-xs ${payment.status === 'COMPLETED' ? 'bg-green-900 text-green-300' : payment.status === 'PENDING' ? 'bg-yellow-900 text-yellow-300' : 'bg-red-900 text-red-300'}">
                  ${payment.status || 'UNKNOWN'}
                </span>
              </td>
              <td class="py-2 px-4">
                <button class="text-blue-400 hover:text-blue-300" onclick="viewPaymentDetails(${payment.id})">
                  <i class="fas fa-receipt"></i>
                </button>
              </td>
            `;
            
            paymentsTableBody.appendChild(row);
          });
          
          showToast('Payment data updated', 'success');
        } else {
          showToast('Failed to load payment data', 'error');
        }
      } catch (error) {
        console.error('Error loading payment data:', error);
        showToast('Error loading payment data', 'error');
      }
    }
    
    // Load system data
    async function loadSystemData() {
      try {
        // Get system monitoring data using the stored auth token
        const authToken = localStorage.getItem('auth_token');
        const response = await fetch('/api/admin/system-monitoring', {
          headers: {
            'Authorization': authToken ? `Bearer ${authToken}` : ''
          }
        });
        
        if (response.ok) {
          const data = await response.json();
          
          // Update system monitoring metrics
          document.getElementById('cpu-usage').textContent = data.cpuUsage + '%';
          document.getElementById('memory-usage').textContent = data.memoryUsage + '%';
          document.getElementById('disk-usage').textContent = data.diskUsage + '%';
          document.getElementById('active-sessions').textContent = data.activeSessions;
          document.getElementById('request-rate').textContent = data.requestRate + '/min';
          document.getElementById('error-rate').textContent = data.errorRate + '%';
          document.getElementById('system-uptime-full').textContent = data.uptime;
          
          // Update progress bars
          document.getElementById('cpu-progress').style.width = data.cpuUsage + '%';
          document.getElementById('memory-progress').style.width = data.memoryUsage + '%';
          document.getElementById('disk-progress').style.width = data.diskUsage + '%';
          
          // Set progress bar colors based on usage levels
          document.getElementById('cpu-progress').className = `h-2 rounded transition-all duration-500 ${data.cpuUsage > 80 ? 'bg-red-500' : data.cpuUsage > 60 ? 'bg-yellow-500' : 'bg-green-500'}`;
          document.getElementById('memory-progress').className = `h-2 rounded transition-all duration-500 ${data.memoryUsage > 80 ? 'bg-red-500' : data.memoryUsage > 60 ? 'bg-yellow-500' : 'bg-green-500'}`;
          document.getElementById('disk-progress').className = `h-2 rounded transition-all duration-500 ${data.diskUsage > 80 ? 'bg-red-500' : data.diskUsage > 60 ? 'bg-yellow-500' : 'bg-green-500'}`;
          
          showToast('System monitoring data updated', 'success');
        } else {
          showToast('Failed to load system monitoring data', 'error');
        }
      } catch (error) {
        console.error('Error loading system monitoring data:', error);
        showToast('Error loading system monitoring data', 'error');
      }
    }
    
    // Load security data
    async function loadSecurityData() {
      loadAuditLog();
    }
    
    // Load settings data
    async function loadSettingsData() {
      // Settings are loaded statically, no API call needed
      showToast('Settings loaded', 'success');
    }
    
    // Add functions for CRUD operations
    function editUser(userId) {
      showToast(`Editing user ${userId} - functionality to be implemented`, 'success');
    }
    
    function deleteUser(userId) {
      if (confirm(`Are you sure you want to delete user ${userId}?`)) {
        showToast(`User ${userId} will be deleted - functionality to be implemented`, 'success');
      }
    }
    
    function editPartner(partnerId) {
      showToast(`Editing partner ${partnerId} - functionality to be implemented`, 'success');
    }
    
    function viewReferrals(partnerId) {
      showToast(`Viewing referrals for partner ${partnerId} - functionality to be implemented`, 'success');
    }
    
    function deletePartner(partnerId) {
      if (confirm(`Are you sure you want to delete partner ${partnerId}?`)) {
        showToast(`Partner ${partnerId} will be deleted - functionality to be implemented`, 'success');
      }
    }
    
    function editAIModel(modelId) {
      showToast(`Editing AI model ${modelId} - functionality to be implemented`, 'success');
    }
    
    function toggleAIModelStatus(modelId, currentStatus) {
      const newStatus = currentStatus === 'ACTIVE' ? 'INACTIVE' : 'ACTIVE';
      showToast(`AI model ${modelId} status changed to ${newStatus} - functionality to be implemented`, 'success');
    }
    
    function previewVideo(videoId) {
      showToast(`Previewing video ${videoId} - functionality to be implemented`, 'success');
    }
    
    function deleteVideo(videoId) {
      if (confirm(`Are you sure you want to delete video ${videoId}?`)) {
        showToast(`Video ${videoId} will be deleted - functionality to be implemented`, 'success');
      }
    }
    
    function viewCallDetails(callId) {
      showToast(`Viewing details for call ${callId} - functionality to be implemented`, 'success');
    }
    
    function playCallRecording(callId) {
      showToast(`Playing recording for call ${callId} - functionality to be implemented`, 'success');
    }
    
    function viewPaymentDetails(paymentId) {
      showToast(`Viewing details for payment ${paymentId} - functionality to be implemented`, 'success');
    }
    
    // User/Partner Creation Functions
    function showCreateUserModal() {
      document.getElementById('create-user-modal').classList.remove('hidden');
    }
    
    function hideCreateUserModal() {
      document.getElementById('create-user-modal').classList.add('hidden');
      document.getElementById('create-user-form').reset();
    }
    
    function showCreatePartnerModal() {
      document.getElementById('create-partner-modal').classList.remove('hidden');
    }
    
    function hideCreatePartnerModal() {
      document.getElementById('create-partner-modal').classList.add('hidden');
      document.getElementById('create-partner-form').reset();
    }
    
    async function createUser(event) {
      event.preventDefault();
      
      const form = event.target;
      const formData = new FormData(form);
      
      // Disable submit button to prevent double submission
      const submitBtn = form.querySelector('button[type="submit"]');
      const originalBtnText = submitBtn.innerHTML;
      submitBtn.disabled = true;
      submitBtn.innerHTML = '<div class="loader mr-2"></div> Creating...';
      
      // Get form data
      const username = formData.get('username');
      const email = formData.get('email');
      const displayName = formData.get('displayName');
      const isAdmin = formData.get('isAdmin') === 'true';
      
      const userData = {
        username: username,
        email: email,
        password: formData.get('password'),
        displayName: displayName,
        isAdmin: isAdmin
      };
      
      try {
        // Get the Authorization header with Basic Auth
        const authToken = localStorage.getItem('auth_token');
        const authHeader = authToken ? `Bearer ${authToken}` : '';
        
        console.log('Creating user account with data:', JSON.stringify({
          ...userData, 
          password: '******' // Don't log the actual password
        }));
        
        const response = await fetch('/api/admin/users', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': authHeader
          },
          body: JSON.stringify(userData)
        });
        
        if (!response.ok) {
          let errorObj;
          try {
            errorObj = await response.json();
          } catch(e) {
            throw new Error('Failed to create user: Network error');
          }
          
          if (errorObj.error && errorObj.error.includes('already exists')) {
            throw new Error('A user with this email or username already exists. Please use different credentials.');
          } else {
            throw new Error(errorObj.error || errorObj.message || 'Failed to create user');
          }
        }
        
        const newUser = await response.json();
        console.log('User created successfully:', newUser);
        
        // Hide modal and reset form
        hideCreateUserModal();
        form.reset();
        
        // Reload users data
        loadUsersData();
        
        // Show success message
        showToast(`User "${displayName}" created successfully`, 'success');
      } catch (error) {
        console.error('Error creating user:', error);
        showToast(error.message || 'Failed to create user account', 'error');
      } finally {
        // Re-enable submit button
        submitBtn.disabled = false;
        submitBtn.innerHTML = originalBtnText;
      }
    }
    
    async function createPartner(event) {
      event.preventDefault();
      
      const form = event.target;
      const formData = new FormData(form);
      
      // Disable submit button to prevent double submission
      const submitBtn = form.querySelector('button[type="submit"]');
      const originalBtnText = submitBtn.innerHTML;
      submitBtn.disabled = true;
      submitBtn.innerHTML = '<div class="loader mr-2"></div> Creating...';
      
      // Get form data
      const email = formData.get('email');
      const companyName = formData.get('companyName');
      const status = formData.get('status');
      
      try {
        // Get the Authorization header with Basic Auth
        const authToken = localStorage.getItem('auth_token');
        const authHeader = authToken ? `Bearer ${authToken}` : '';
        
        // Create the user with role=partner specifically
        const userData = {
          username: formData.get('username'),
          email: email,
          password: formData.get('password'),
          displayName: companyName, // Use company name as display name
          isAdmin: false, // Partners should never have admin privileges
          role: 'partner', // This is important - specify the role
          partnerInfo: {
            companyName: companyName,
            commissionRate: 15, // Default commission rate
            status: status // Pass the selected status
          }
        };
        
        console.log('Creating partner account with data:', JSON.stringify(userData));
        
        const userResponse = await fetch('/api/admin/users', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': authHeader
          },
          body: JSON.stringify(userData)
        });
        
        if (!userResponse.ok) {
          let errorObj;
          try {
            errorObj = await userResponse.json();
          } catch(e) {
            throw new Error('Failed to create partner: Network error');
          }
          
          if (errorObj.error && errorObj.error.includes('already exists')) {
            throw new Error('A user with this email already exists. Please use a different email address.');
          } else {
            throw new Error(errorObj.error || errorObj.message || 'Failed to create partner');
          }
        }
        
        const result = await userResponse.json();
        console.log('Partner account created successfully:', result);
        
        // Hide modal and reset form
        hideCreatePartnerModal();
        form.reset();
        
        // Reload partners data
        loadPartnersData();
        
        // Show success message
        showToast(`Partner "${companyName}" created successfully`, 'success');
      } catch (error) {
        console.error('Error creating partner:', error);
        showToast(error.message || 'Failed to create partner account', 'error');
      } finally {
        // Re-enable submit button
        submitBtn.disabled = false;
        submitBtn.innerHTML = originalBtnText;
      }
    }
    
    async function loadUsersData() {
      try {
        // Get the Authorization header with Basic Auth
        const authToken = localStorage.getItem('auth_token');
        const authHeader = authToken ? `Bearer ${authToken}` : '';
        
        console.log("Loading users data...");
        
        const response = await fetch('/api/admin/users', {
          headers: {
            'Authorization': authHeader
          }
        });
        
        if (!response.ok) {
          throw new Error('Failed to load users');
        }
        
        const data = await response.json();
        console.log("Users data received:", data);
        
        // Handle different response formats
        let users = [];
        if (Array.isArray(data)) {
          users = data;
        } else if (data.users && Array.isArray(data.users)) {
          users = data.users;
        } else {
          console.error("Unexpected data format:", data);
          throw new Error('Unexpected data format');
        }
        
        const tableBody = document.getElementById('users-table-body');
        if (!tableBody) {
          console.error("Cannot find users-table-body element");
          throw new Error('Cannot find users table body element');
        }
        
        tableBody.innerHTML = '';
        
        if (users.length === 0) {
          tableBody.innerHTML = `
            <tr>
              <td colspan="7" class="text-center py-4">
                <p class="text-gray-400">No users found</p>
              </td>
            </tr>
          `;
          return;
        }
        
        users.forEach(user => {
          const row = document.createElement('tr');
          
          // Debug the user object
          console.log("Processing user:", user);
          
          // Safely access properties with debug info
          console.log("User data keys:", Object.keys(user));
          
          const id = user.id || '';
          const username = user.name || user.username || '';
          const email = user.email || '';
          const createdAt = user.createdAt ? new Date(user.createdAt).toLocaleDateString() : 'Unknown';
          const lastLogin = user.lastLogin ? new Date(user.lastLogin).toLocaleString() : 'Never';
          const isAdmin = user.isAdmin || (user.role === 'Admin');
          
          row.innerHTML = `
            <td>${id}</td>
            <td>${username}</td>
            <td>${email}</td>
            <td>${createdAt}</td>
            <td>${lastLogin}</td>
            <td>${isAdmin ? '<span class="status-badge badge-admin">Admin</span>' : '<span class="status-badge badge-user">User</span>'}</td>
            <td>
              <div class="flex space-x-2">
                <button class="text-blue-400 hover:text-blue-500" title="Edit User" onclick="editUser(${id})">
                  <i class="fas fa-edit"></i>
                </button>
                <button class="text-red-400 hover:text-red-500" title="Delete User" onclick="deleteUser(${id})">
                  <i class="fas fa-trash-alt"></i>
                </button>
              </div>
            </td>
          `;
          tableBody.appendChild(row);
        });
        
        const userCountElement = document.getElementById('user-count');
        if (userCountElement) {
          userCountElement.textContent = users.length;
        }
        
        console.log("Users data loaded successfully:", users.length, "users");
      } catch (error) {
        console.error('Error loading users:', error);
        showToast('Failed to load users: ' + error.message, 'error');
      }
    }
    
    async function loadPartnersData() {
      try {
        // Get the Authorization header with Basic Auth
        const authToken = localStorage.getItem('auth_token');
        const authHeader = authToken ? `Bearer ${authToken}` : '';
        
        console.log("Loading partners data...");
        
        const response = await fetch('/api/admin/partners', {
          headers: {
            'Authorization': authHeader
          }
        });
        
        if (!response.ok) {
          throw new Error('Failed to load partners');
        }
        
        const data = await response.json();
        console.log("Partners data received:", data);
        
        // Handle different response formats
        let partners = [];
        if (Array.isArray(data)) {
          partners = data;
        } else if (data.partners && Array.isArray(data.partners)) {
          partners = data.partners;
        } else {
          console.error("Unexpected data format:", data);
          throw new Error('Unexpected data format');
        }
        
        const tableBody = document.getElementById('partners-table-body');
        if (!tableBody) {
          console.error("Cannot find partners-table-body element");
          throw new Error('Cannot find partners table body element');
        }
        
        tableBody.innerHTML = '';
        
        if (partners.length === 0) {
          tableBody.innerHTML = `
            <tr>
              <td colspan="6" class="text-center py-4">
                <p class="text-gray-400">No partners found</p>
              </td>
            </tr>
          `;
          return;
        }
        
        partners.forEach(partner => {
          // Debug the partner object
          console.log("Processing partner:", partner);
          
          const row = document.createElement('tr');
          
          // Safely access properties with fallbacks - debug info to console
          console.log("Partner data keys:", Object.keys(partner));
          
          const id = partner.id || '';
          const companyName = partner.name || partner.companyName || 'Unknown';
          const email = partner.userEmail || partner.email || '';
          const status = partner.status || 'UNKNOWN';
          const referrals = partner.referrals || 0;
          const commission = partner.commission || partner.totalCommission || '$0.00';
          const createdDate = partner.joined || partner.createdAt || new Date().toISOString();
          
          // Format the status for display and class use
          const statusDisplay = status.charAt(0).toUpperCase() + status.slice(1).toLowerCase();
          const statusClass = status.toLowerCase();
          
          // Get the first letter for the avatar
          const firstLetter = (companyName.charAt(0) || 'P').toUpperCase();
          
          row.innerHTML = `
            <td>
              <div class="flex items-center">
                <div class="w-8 h-8 bg-primary rounded-full flex items-center justify-center mr-3">
                  ${firstLetter}
                </div>
                <div>
                  <div class="font-medium">${companyName}</div>
                  <div class="text-xs text-gray-400">${email}</div>
                </div>
              </div>
            </td>
            <td><span class="status-badge badge-${statusClass}">${statusDisplay}</span></td>
            <td>${referrals}</td>
            <td>${commission}</td>
            <td>${new Date(createdDate).toLocaleDateString()}</td>
            <td>
              <div class="flex space-x-2">
                <button class="text-blue-400 hover:text-blue-500" title="Edit Partner" onclick="editPartner(${id})">
                  <i class="fas fa-edit"></i>
                </button>
                <button class="text-green-400 hover:text-green-500" title="View Details" onclick="viewPartnerDetails(${id})">
                  <i class="fas fa-eye"></i>
                </button>
                <button class="text-yellow-400 hover:text-yellow-500" title="Add Payment" onclick="addPartnerPayment(${id})">
                  <i class="fas fa-dollar-sign"></i>
                </button>
              </div>
            </td>
          `;
          tableBody.appendChild(row);
        });
        
        const partnerCountElement = document.getElementById('partner-count');
        if (partnerCountElement) {
          partnerCountElement.textContent = partners.length;
        }
        
        console.log("Partners data loaded successfully:", partners.length, "partners");
      } catch (error) {
        console.error('Error loading partners:', error);
        showToast('Failed to load partners: ' + error.message, 'error');
      }
    }
  </script>
  
  <!-- Create User Modal -->
  <div id="create-user-modal" class="fixed inset-0 z-50 hidden flex items-center justify-center bg-black bg-opacity-50">
    <div class="bg-background-light rounded-lg w-full max-w-md p-6">
      <div class="flex justify-between items-center mb-4">
        <h3 class="text-xl font-bold">Create New User</h3>
        <button onclick="hideCreateUserModal()" class="text-gray-400 hover:text-gray-300">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <form id="create-user-form" onsubmit="createUser(event)">
        <div class="mb-4">
          <label class="block text-sm font-medium mb-1">Username</label>
          <input type="text" name="username" class="admin-input w-full" required>
        </div>
        
        <div class="mb-4">
          <label class="block text-sm font-medium mb-1">Email</label>
          <input type="email" name="email" class="admin-input w-full" required>
        </div>
        
        <div class="mb-4">
          <label class="block text-sm font-medium mb-1">Password</label>
          <input type="password" name="password" class="admin-input w-full" required>
        </div>
        
        <div class="mb-4">
          <label class="block text-sm font-medium mb-1">Display Name</label>
          <input type="text" name="displayName" class="admin-input w-full" required>
        </div>
        
        <div class="mb-4">
          <label class="block text-sm font-medium mb-1">Role</label>
          <select name="isAdmin" class="admin-select w-full">
            <option value="false">Regular User</option>
            <option value="true">Admin</option>
          </select>
        </div>
        
        <div class="flex justify-end space-x-2">
          <button type="button" onclick="hideCreateUserModal()" class="admin-btn-secondary">Cancel</button>
          <button type="submit" class="admin-btn">Create User</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Create Partner Modal -->
  <div id="create-partner-modal" class="fixed inset-0 z-50 hidden flex items-center justify-center bg-black bg-opacity-50">
    <div class="bg-background-light rounded-lg w-full max-w-md p-6">
      <div class="flex justify-between items-center mb-4">
        <h3 class="text-xl font-bold">Create New Partner</h3>
        <button onclick="hideCreatePartnerModal()" class="text-gray-400 hover:text-gray-300">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <form id="create-partner-form" onsubmit="createPartner(event)">
        <div class="mb-4">
          <label class="block text-sm font-medium mb-1">Username</label>
          <input type="text" name="username" class="admin-input w-full" required>
        </div>
        
        <div class="mb-4">
          <label class="block text-sm font-medium mb-1">Email</label>
          <input type="email" name="email" class="admin-input w-full" required>
        </div>
        
        <div class="mb-4">
          <label class="block text-sm font-medium mb-1">Password</label>
          <input type="password" name="password" class="admin-input w-full" required>
        </div>
        
        <div class="mb-4">
          <label class="block text-sm font-medium mb-1">Company Name</label>
          <input type="text" name="companyName" class="admin-input w-full" required>
        </div>
        
        <div class="mb-4">
          <label class="block text-sm font-medium mb-1">Initial Tokens</label>
          <input type="number" name="initialTokens" class="admin-input w-full" value="100" min="0" required>
        </div>
        
        <div class="mb-4">
          <label class="block text-sm font-medium mb-1">Status</label>
          <select name="status" class="admin-select w-full">
            <option value="ACTIVE">Active</option>
            <option value="PENDING">Pending</option>
            <option value="SUSPENDED">Suspended</option>
          </select>
        </div>
        
        <div class="flex justify-end space-x-2">
          <button type="button" onclick="hideCreatePartnerModal()" class="admin-btn-secondary">Cancel</button>
          <button type="submit" class="admin-btn">Create Partner</button>
        </div>
      </form>
    </div>
  </div>
</body>
</html>